"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{27994:function(e,t,n){n.d(t,{O:function(){return f}});var i=n(9268),r=n(54911),l=n(69482),u=n(17719),o=n(86006),s=n(96454),c=n(1881);n(20075),n(50374),n(97589);let a=(e,t)=>({title:(0,i.jsxs)("em",{children:["No schema found for type ",(0,i.jsx)("code",{children:t})]}),subtitle:(0,i.jsxs)("em",{children:["Document: ",(0,i.jsx)("code",{children:e})]}),media:()=>(0,i.jsx)(r.foC,{})});function d(e){let{layout:t,value:n}=e;return(0,i.jsx)(s.ogX,{...a(n._id,n._type),layout:t})}function m(e,t,n){return!1!==e&&(e||t&&t.icon||n||!1)}function f(e){let{icon:t,id:n,layout:a="default",pressed:f,schemaType:p,selected:h,title:x,value:g}=e,j=(0,s.I_y)(),y=(0,s.rq_)(),{ChildLink:v}=(0,c.RL)(),b=(0,s.Dqo)(n),_=!!(p&&p.name&&j.get(p.name)),[k,C]=(0,o.useState)(!1),T=(0,o.useMemo)(()=>g&&(0,l.Si)(g)?p&&_?(0,i.jsx)(c.iJ,{documentPreviewStore:y,icon:m(t,p,r.$lS),layout:a,schemaType:p,value:g,presence:b}):(0,i.jsx)(d,{value:g}):(0,i.jsx)(s.ogX,{status:(0,i.jsx)(u.xv,{muted:!0,children:(0,i.jsx)(r.XCv,{})}),icon:m(t,p,r.ROc),layout:a,title:x}),[y,_,t,a,p,x,g,b]),w=(0,o.useMemo)(()=>function(e){return(0,i.jsx)(v,{...e,childId:n})},[v,n]),M=(0,o.useCallback)(()=>C(!0),[]);return(0,o.useEffect)(()=>C(!1),[h]),(0,i.jsx)(s.oUE,{__unstable_focusRing:!0,as:w,"data-as":"a","data-ui":"PaneItem",padding:2,radius:2,onClick:M,pressed:f,selected:h||k,tone:"inherit",children:T})}},44766:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var i=n(9268),r=n(86006),l=n(17719),u=n(6160),o=n.n(u),s=n(4974),c=n.n(s),a=n(54911);n(97589);var d=n(1881),m=n(53338),f=n(50374),p=n(69482),h=n(96454),x=n(27994);n(20075),n(28747),n(782),n(84231);var g=n(79372),j=n(83062),y=n(63623),v=n(45234),b=n(63724),_=n(7891),k=n(90255),C=n(30742),T=n(83448),w=n(93477),M=n(39067),D=n(41561),R=n(5410),W=n(53434),L=n(10197),X=n(64331),$=n(42766),I=n(2278),O=n(67042),S=n(35390),E=n.n(S);let q={by:[{field:"_updatedAt",direction:"desc"}]},z={};function B(e,t){return e._id?(0,h.vsM)(e._id):"item-".concat(t)}let N=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function P(e){let{childItemId:t,error:n,filterIsSimpleTypeContraint:u,fullList:o,isActive:s,isLoading:c,items:f,layout:p,onListChange:g,onRetry:j,showIcons:y}=e,v=(0,h.I_y)(),{collapsed:b}=(0,d.Cc)(),{collapsed:_,index:k}=(0,d.ec)(),[C,T]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(_)return;let e=setTimeout(()=>{T(!0)},0);return()=>{clearTimeout(e)}},[_]);let w=(0,r.useCallback)(e=>{let n=(0,h.vsM)(e._id),r=t===n,l=!s&&r,u=s&&r;return(0,i.jsx)(x.O,{icon:!1!==y&&void 0,id:n,pressed:l,selected:u,layout:p,schemaType:v.get(e._type),value:e})},[t,s,p,v,y]),M=(0,r.useMemo)(()=>{if(!C)return null;if(n)return(0,i.jsx)(l.kC,{align:"center",direction:"column",height:"fill",justify:"center",children:(0,i.jsx)(l.W2,{width:1,children:(0,i.jsxs)(l.Kq,{paddingX:4,paddingY:5,space:4,children:[(0,i.jsx)(l.X6,{as:"h3",children:"Could not fetch list items"}),(0,i.jsxs)(l.xv,{as:"p",children:["Error: ",(0,i.jsx)("code",{children:n.message})]}),j&&(0,i.jsx)(l.xu,{children:(0,i.jsx)(l.zx,{icon:a.bnu,onClick:j,text:"Retry",tone:"primary"})})]})})});if(null===f)return(0,i.jsx)(l.kC,{align:"center",direction:"column",height:"fill",justify:"center",children:(0,i.jsx)(m.Delay,{ms:300,children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.$j,{muted:!0}),(0,i.jsx)(l.xu,{marginTop:3,children:(0,i.jsx)(l.xv,{align:"center",muted:!0,size:1,children:"Loading documents…"})})]})})});if(!c&&0===f.length)return(0,i.jsx)(l.kC,{align:"center",direction:"column",height:"fill",justify:"center",children:(0,i.jsx)(l.W2,{width:1,children:(0,i.jsx)(l.xu,{paddingX:4,paddingY:5,children:(0,i.jsx)(l.xv,{align:"center",muted:!0,size:2,children:u?"No documents of this type":"No matching documents"})})})});let e=o&&2e3===f.length;return(0,i.jsxs)(l.xu,{padding:2,children:[f.length>0&&(0,i.jsx)(l.CP,{gap:1,getItemKey:B,items:f,renderItem:w,onChange:g},"".concat(k,"-").concat(_)),c&&(0,i.jsx)(l.Zb,{borderTop:!0,marginTop:1,paddingX:3,paddingY:4,children:(0,i.jsx)(l.xv,{align:"center",muted:!0,size:1,children:"Loading…"})}),e&&(0,i.jsx)(l.Zb,{marginTop:1,paddingX:3,paddingY:4,radius:2,tone:"transparent",children:(0,i.jsxs)(l.xv,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",2e3," documents"]})})]})},[n,u,o,g,c,f,j,w,C,_,k]);return(0,i.jsx)(d.Bh,{overflow:b?void 0:"auto",children:M})}let Y=(0,r.memo)(e=>{let{index:t,initialValueTemplates:n=[],menuItems:u=[],menuItemGroups:o=[],setLayout:s,setSortOrder:c,title:f}=e,{features:p}=(0,m.useDeskTool)(),h=(0,r.useMemo)(()=>({setLayout:e=>{let{layout:t}=e;s(t)},setSortOrder:e=>{c(e)}}),[s,c]);return(0,i.jsx)(d.hX,{backButton:p.backButton&&t>0&&(0,i.jsx)(l.zx,{as:d.hb,"data-as":"a",icon:a.Y4O,mode:"bleed"}),title:f,actions:(0,i.jsx)(d.cp,{initialValueTemplateItems:n,actionHandlers:h,menuItemGroups:o,menuItems:u})})});Y.displayName="DocumentListPaneHeader";let K={result:null,error:!1},U=e=>({result:{documents:e},loading:!1,error:!1}),F=e=>({result:null,loading:!1,error:e}),V=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new g.x,i=n.next.bind(n),r=e.pipe((0,_.U)(e=>({client:e.client,query:e.query,params:e.params})),(0,k.x)(E()),(0,C._)(1),(0,T.x)()),l=r.pipe((0,w.w)(e=>{let n=(0,h.OPK)(e.client,e.query,e.params,t).pipe((0,_.U)(U),(0,M.B)());return(0,j.T)((0,y.of)({loading:!0}).pipe((0,D.g)(400),(0,R.R)(n)),n)}));return l.pipe((0,W.O)(K),(0,L.K)((e,t)=>(0,v.z)((0,y.of)(F(e)),(0,j.T)((0,b.R)(window,"online"),n).pipe((0,X.q)(1),(0,$.j)(t)))),(0,I.R)((e,t)=>({...e,...t,onRetry:i})))},Z=[],A=e=>{let{menuItems:t,sortOrderRaw:n,layout:i}=e;return null==t?void 0:t.map(e=>{var t,r,l,u;return(null==(t=e.params)?void 0:t.layout)?{...e,selected:i===(null==(r=e.params)?void 0:r.layout)}:(null==(l=null==e?void 0:e.params)?void 0:l.by)?{...e,selected:c()(null==n?void 0:n.by,(null==(u=null==e?void 0:e.params)?void 0:u.by)||Z)}:{...e,selected:!1}})},H=(0,r.memo)(function(e){let{childItemId:t,index:n,isActive:l,isSelected:u,pane:s,paneKey:c}=e,a=(0,h.I_y)(),{name:x}=(0,h.Lky)(),{defaultLayout:g="default",displayOptions:j,initialValueTemplates:v=Z,menuItems:b,menuItemGroups:_,options:k,title:C}=s,{apiVersion:T,defaultOrdering:w=Z,filter:M}=k,D=function(e){let t=(0,r.useRef)(e);return o()(t.current,e)||(t.current=e),t.current}(k.params||z),R=s.source,W=(0,r.useMemo)(()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(N);if(!n)return null;let i=(n[1]||n[2]).trim().replace(/^["']|["']$/g,"");if("$"===i[0]){let e=i.slice(1),n=t[e];return"string"==typeof n?n:null}return i})(M,D),[M,D]),L=(null==j?void 0:j.showIcons)!==!1,[X,$]=(0,m.useDeskToolSetting)(W,"layout",g),I=(0,r.useMemo)(()=>(null==w?void 0:w.length)>0?{by:w}:q,[w]),[S,E]=(0,m.useDeskToolSetting)(W,"sortOrder",I),B=W&&S?function(e,t){let n=e.by.map(e=>{if(e.mapWith)return e;let n=function(e,t){let n=f.mL(t),i=e;for(let e of n){if(!i)return;if("string"==typeof e){i=function(e,t){if(!("fields"in e))return;let n=e.fields.find(e=>e.name===t);return n?n.type:void 0}(i,e);continue}let t=(0,p.Fd)(e)||(0,p.dw)(e);if(!t||"array"!==i.jsonType)return;let[n,r]=i.of||[];if(r||!n)return;if(!(0,p.dD)(n)){i=n;continue}let[l,u]=n.to||[];if(u||!l)return;i=l}return i}(t,e.field);return n?!function(e,t){let n=e.type;for(;n;){if(n.name===t||!n.type&&n.jsonType===t)return!0;n=n.type}return!1}(n,"datetime")?"string"===n.jsonType?{...e,mapWith:"lower"}:e:{...e,mapWith:"dateTime"}:e});return n.every((t,n)=>t===e.by[n])?e:{...e,by:n}}(S,a.get(W)):S,K=(0,h.BoV)(B),U=/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(M.trim()),{error:F,fullList:H,handleListChange:J,isLoading:G,items:Q,onRetry:ee}=function(e){var t;let{apiVersion:n,filter:i,params:l,sortOrder:u}=e,o=(0,h.m85)(h.Dr7),[s,c]=(0,r.useState)(!1),a=(0,r.useRef)(s),[d,m]=(0,r.useState)(null),f=(null==d?void 0:d.error)||null,p=(null==d?void 0:d.loading)||null===d,x=null==d?void 0:d.onRetry,g=null==(t=null==d?void 0:d.result)?void 0:t.documents,j=(0,r.useMemo)(()=>g?(0,h.RgL)(g).map(e=>{let t=e.draft||e.published;return{...t,hasPublished:!!e.published,hasDraft:!!e.draft}}):null,[g]),v=(0,r.useMemo)(()=>{let e=null==u?void 0:u.extendedProjection,t=["_id","_type"],n=t.join(","),r=(null==u?void 0:u.by)||[],l=s?2e3:100,o=r.length>0?r:q.by,c=o.map(e=>[e.mapWith?"".concat(e.mapWith,"(").concat(e.field,")"):e.field,(e.direction||"").toLowerCase()].map(e=>e.trim()).filter(Boolean).join(" ")).join(",");if(e){let r=t.concat(e).join(",");return["*[".concat(i,"] {").concat(r,"}"),"order(".concat(c,") [0...").concat(l,"]"),"{".concat(n,"}")].join("|")}return"*[".concat(i,"]|order(").concat(c,")[0...").concat(l,"]{").concat(n,"}")},[i,s,u]),b=(0,r.useCallback)(e=>{let{toIndex:t}=e;p||a.current||!(t>=50)||(c(!0),a.current=!0)},[p]);return(0,r.useEffect)(()=>{let e=s?e=>!!e.result:()=>!0;m(e=>e?{...e,loading:!0}:null);let t=V((0,y.of)({client:o,query:v,params:l}),{apiVersion:n,tag:"desk.document-list"}).pipe((0,O.h)(e)),i=t.subscribe(m);return()=>i.unsubscribe()},[n,o,s,v,l]),(0,r.useEffect)(()=>{m(null),c(!1),a.current=!1},[i,l,u,n]),{error:f,fullList:s,handleListChange:b,isLoading:p,items:j,onRetry:x}}({filter:M,params:D,sortOrder:K,apiVersion:T}),et=(0,r.useMemo)(()=>A({menuItems:b,sortOrderRaw:S,layout:X}),[X,b,S]);return(0,i.jsx)(h.cWh,{name:R||x,children:(0,i.jsxs)(d.X6,{currentMaxWidth:350,id:c,maxWidth:640,minWidth:320,selected:u,children:[d.Oo,(0,i.jsx)(Y,{index:n,initialValueTemplates:v,menuItems:et,menuItemGroups:_,setLayout:$,setSortOrder:E,title:C}),(0,i.jsx)(P,{childItemId:t,error:F,filterIsSimpleTypeContraint:U,fullList:H,isActive:l,isLoading:G,items:Q,layout:X,onListChange:J,onRetry:ee,showIcons:L})]})})})}}]);