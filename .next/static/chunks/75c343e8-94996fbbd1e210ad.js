"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{15918:function(e,t,n){n.d(t,{L9:function(){return tv},_F:function(){return tb},iV:function(){return tZ},q$:function(){return tA}});var r,i,l,o,a,s=n(9268),c=n(86006),h=n(54130),f=n(22461),d=n(93477),p=n(63623),u=n(14385),g=n(70172),m=n(79372),y=n(39769),k=n(2746),v=n.n(k),_=n(44005),b=n(92178),x=n(52138),w=n(48172),M=n.n(w),E=n(41671),N=n.n(E),T=n(41972),D=n.n(T),A=n(53671),C=n.n(A),S=n(33563),L=n.n(S),P=n(4974),R=n.n(P),I=n(77326),B=n(74331),j=n.n(B),O=n(782),Y=n.n(O),W=n(74679),z=n.n(W),J=n(20075),V=n.n(J),F=n(8650),U=n.n(F),$=n(64774),H=n.n($),q=n(34268),Z=n(92844),G=n(56762),K=n.n(G),X=n(18488);function Q(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ee(e){return y.V.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}function et(e){var t,n,r;if(!e)throw Error("Parameter 'portabletextType' missing (required)");let i=null==(t=e.of)?void 0:t.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!i)throw Error("Block type is not defined in this schema (required)");let l=null==(n=i.fields)?void 0:n.find(e=>"children"===e.name);if(!l)throw Error("Children field for block type found in schema (required)");let o=l.type.of;if(!o)throw Error("Valid types for block children not found in schema (required)");let a=o.find(e=>"span"===e.name);if(!a)throw Error("Span type not found in schema (required)");let s=o.filter(e=>"span"!==e.name)||[],c=(null==(r=e.of)?void 0:r.filter(e=>e.name!==i.name))||[];return{styles:function(e){var t,n,r;let i=null==(t=e.fields)?void 0:t.find(e=>"style"===e.name);if(!i)throw Error("A field with name 'style' is not defined in the block type (required).");let l=(null==(n=i.type.options)?void 0:n.list)&&(null==(r=i.type.options.list)?void 0:r.filter(e=>e.value));if(!l||0===l.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return l}(i),decorators:a.decorators,lists:function(e){var t,n;let r=null==(t=e.fields)?void 0:t.find(e=>"list"===e.name);if(!r)throw Error("A field with name 'list' is not defined in the block type (required).");let i=(null==(n=r.type.options)?void 0:n.list)&&r.type.options.list.filter(e=>e.value);if(!i)throw Error("The list field need at least to be an empty array");return i}(i),block:i,span:a,portableText:e,inlineObjects:s,blockObjects:c,annotations:a.annotations}}let en="sanity-pte:";function er(e){let t="".concat(en).concat(e);return v()&&v().enabled(t)?v()(t):v()(en)}v()(en);let ei=()=>(0,_.E2)(12),el=(0,c.createContext)(ei),eo=()=>{let e=(0,c.useContext)(el);if(void 0===e)throw Error("The `usePortableTextEditorKeyGenerator` hook must be used inside the <PortableTextEditor> component's context.");return e},ea=new WeakMap,es=new WeakMap,ec=new WeakMap,eh=new WeakMap,ef=new WeakMap,ed=new WeakMap,ep=new WeakMap;var eu={exports:{}};(r=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}).Diff=function(e,t){return[e,t]},r.prototype.diff_main=function(e,t,n,i){void 0===i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:new Date().getTime()+1e3*this.Diff_Timeout);var l=i;if(null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new r.Diff(0,e)]:[];void 0===n&&(n=!0);var o=n,a=this.diff_commonPrefix(e,t),s=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var c=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var h=this.diff_compute_(e,t,o,l);return s&&h.unshift(new r.Diff(0,s)),c&&h.push(new r.Diff(0,c)),this.diff_cleanupMerge(h),h},r.prototype.diff_compute_=function(e,t,n,i){if(!e)return[new r.Diff(1,t)];if(!t)return[new r.Diff(-1,e)];var l,o=e.length>t.length?e:t,a=e.length>t.length?t:e,s=o.indexOf(a);if(-1!=s)return l=[new r.Diff(1,o.substring(0,s)),new r.Diff(0,a),new r.Diff(1,o.substring(s+a.length))],e.length>t.length&&(l[0][0]=l[2][0]=-1),l;if(1==a.length)return[new r.Diff(-1,e),new r.Diff(1,t)];var c=this.diff_halfMatch_(e,t);if(c){var h=c[0],f=c[1],d=c[2],p=c[3],u=c[4],g=this.diff_main(h,d,n,i),m=this.diff_main(f,p,n,i);return g.concat([new r.Diff(0,u)],m)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},r.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2;var l=i.lineArray,o=this.diff_main(e,t,!1,n);this.diff_charsToLines_(o,l),this.diff_cleanupSemantic(o),o.push(new r.Diff(0,""));for(var a=0,s=0,c=0,h="",f="";a<o.length;){switch(o[a][0]){case 1:c++,f+=o[a][1];break;case -1:s++,h+=o[a][1];break;case 0:if(s>=1&&c>=1){o.splice(a-s-c,s+c),a=a-s-c;for(var d=this.diff_main(h,f,!1,n),p=d.length-1;p>=0;p--)o.splice(a,0,d[p]);a+=d.length}c=0,s=0,h="",f=""}a++}return o.pop(),o},r.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,l=t.length,o=Math.ceil((i+l)/2),a=2*o,s=Array(a),c=Array(a),h=0;h<a;h++)s[h]=-1,c[h]=-1;s[o+1]=0,c[o+1]=0;for(var f=i-l,d=f%2!=0,p=0,u=0,g=0,m=0,y=0;y<o&&!(new Date().getTime()>n);y++){for(var k=-y+p;k<=y-u;k+=2){for(var v,_=o+k,b=(v=k==-y||k!=y&&s[_-1]<s[_+1]?s[_+1]:s[_-1]+1)-k;v<i&&b<l&&e.charAt(v)==t.charAt(b);)v++,b++;if(s[_]=v,v>i)u+=2;else if(b>l)p+=2;else if(d){var x=o+f-k;if(x>=0&&x<a&&-1!=c[x]){var w=i-c[x];if(v>=w)return this.diff_bisectSplit_(e,t,v,b,n)}}}for(var M=-y+g;M<=y-m;M+=2){for(var w,x=o+M,E=(w=M==-y||M!=y&&c[x-1]<c[x+1]?c[x+1]:c[x-1]+1)-M;w<i&&E<l&&e.charAt(i-w-1)==t.charAt(l-E-1);)w++,E++;if(c[x]=w,w>i)m+=2;else if(E>l)g+=2;else if(!d){var _=o+f-M;if(_>=0&&_<a&&-1!=s[_]){var v=s[_],b=o+v-_;if(v>=(w=i-w))return this.diff_bisectSplit_(e,t,v,b,n)}}}}return[new r.Diff(-1,e),new r.Diff(1,t)]},r.prototype.diff_bisectSplit_=function(e,t,n,r,i){var l=e.substring(0,n),o=t.substring(0,r),a=e.substring(n),s=t.substring(r),c=this.diff_main(l,o,!1,i),h=this.diff_main(a,s,!1,i);return c.concat(h)},r.prototype.diff_linesToChars_=function(e,t){var n=[],r={};function i(e){for(var t="",i=0,o=-1,a=n.length;o<e.length-1;){-1==(o=e.indexOf("\n",i))&&(o=e.length-1);var s=e.substring(i,o+1);(r.hasOwnProperty?r.hasOwnProperty(s):void 0!==r[s])?t+=String.fromCharCode(r[s]):(a==l&&(s=e.substring(i),o=e.length),t+=String.fromCharCode(a),r[s]=a,n[a++]=s),i=o+1}return t}n[0]="";var l=4e4;return l=65535,{chars1:i(e),chars2:i(t),lineArray:n}},r.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],l=0;l<r.length;l++)i[l]=t[r.charCodeAt(l)];e[n][1]=i.join("")}},r.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,l=0;n<i;)e.substring(l,i)==t.substring(l,i)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i},r.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,l=0;n<i;)e.substring(e.length-i,e.length-l)==t.substring(t.length-i,t.length-l)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i},r.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var l=0,o=1;;){var a=e.substring(i-o),s=t.indexOf(a);if(-1==s)return l;o+=s,(0==s||e.substring(i-o)==t.substring(0,o))&&(l=o,o++)}},r.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n,r,i,l,o,a=e.length>t.length?e:t,s=e.length>t.length?t:e;if(a.length<4||2*s.length<a.length)return null;var c=this;function h(e,t,n){for(var r,i,l,o,a=e.substring(n,n+Math.floor(e.length/4)),s=-1,h="";-1!=(s=t.indexOf(a,s+1));){var f=c.diff_commonPrefix(e.substring(n),t.substring(s)),d=c.diff_commonSuffix(e.substring(0,n),t.substring(0,s));h.length<d+f&&(h=t.substring(s-d,s)+t.substring(s,s+f),r=e.substring(0,n-d),i=e.substring(n+f),l=t.substring(0,s-d),o=t.substring(s+f))}return 2*h.length>=e.length?[r,i,l,o,h]:null}var f=h(a,s,Math.ceil(a.length/4)),d=h(a,s,Math.ceil(a.length/2));return f||d?(n=d?f&&f[4].length>d[4].length?f:d:f,e.length>t.length?(r=n[0],i=n[1],l=n[2],o=n[3]):(l=n[0],o=n[1],r=n[2],i=n[3]),[r,i,l,o,n[4]]):null},r.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,l=null,o=0,a=0,s=0,c=0,h=0;o<e.length;)0==e[o][0]?(n[i++]=o,a=c,s=h,c=0,h=0,l=e[o][1]):(1==e[o][0]?c+=e[o][1].length:h+=e[o][1].length,l&&l.length<=Math.max(a,s)&&l.length<=Math.max(c,h)&&(e.splice(n[i-1],0,new r.Diff(-1,l)),e[n[i-1]+1][0]=1,i--,o=--i>0?n[i-1]:-1,a=0,s=0,c=0,h=0,l=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(-1==e[o-1][0]&&1==e[o][0]){var f=e[o-1][1],d=e[o][1],p=this.diff_commonOverlap_(f,d),u=this.diff_commonOverlap_(d,f);p>=u?(p>=f.length/2||p>=d.length/2)&&(e.splice(o,0,new r.Diff(0,d.substring(0,p))),e[o-1][1]=f.substring(0,f.length-p),e[o+1][1]=d.substring(p),o++):(u>=f.length/2||u>=d.length/2)&&(e.splice(o,0,new r.Diff(0,f.substring(0,u))),e[o-1][0]=1,e[o-1][1]=d.substring(0,d.length-u),e[o+1][0]=-1,e[o+1][1]=f.substring(u),o++),o++}o++}},r.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),i=t.charAt(0),l=n.match(r.nonAlphaNumericRegex_),o=i.match(r.nonAlphaNumericRegex_),a=l&&n.match(r.whitespaceRegex_),s=o&&i.match(r.whitespaceRegex_),c=a&&n.match(r.linebreakRegex_),h=s&&i.match(r.linebreakRegex_),f=c&&e.match(r.blanklineEndRegex_),d=h&&t.match(r.blanklineStartRegex_);return f||d?5:c||h?4:l&&!a&&s?3:a||s?2:l||o?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var i=e[n-1][1],l=e[n][1],o=e[n+1][1],a=this.diff_commonSuffix(i,l);if(a){var s=l.substring(l.length-a);i=i.substring(0,i.length-a),l=s+l.substring(0,l.length-a),o=s+o}for(var c=i,h=l,f=o,d=t(i,l)+t(l,o);l.charAt(0)===o.charAt(0);){i+=l.charAt(0),l=l.substring(1)+o.charAt(0),o=o.substring(1);var p=t(i,l)+t(l,o);p>=d&&(d=p,c=i,h=l,f=o)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=h,f?e[n+1][1]=f:(e.splice(n+1,1),n--))}n++}},r.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,r.whitespaceRegex_=/\s/,r.linebreakRegex_=/[\r\n]/,r.blanklineEndRegex_=/\n\r?\n$/,r.blanklineStartRegex_=/^\r?\n\r?\n/,r.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,l=null,o=0,a=!1,s=!1,c=!1,h=!1;o<e.length;)0==e[o][0]?(e[o][1].length<this.Diff_EditCost&&(c||h)?(n[i++]=o,a=c,s=h,l=e[o][1]):(i=0,l=null),c=h=!1):(-1==e[o][0]?h=!0:c=!0,l&&(a&&s&&c&&h||l.length<this.Diff_EditCost/2&&a+s+c+h==3)&&(e.splice(n[i-1],0,new r.Diff(-1,l)),e[n[i-1]+1][0]=1,i--,l=null,a&&s?(c=h=!0,i=0):(o=--i>0?n[i-1]:-1,c=h=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},r.prototype.diff_cleanupMerge=function(e){e.push(new r.Diff(0,""));for(var t,n=0,i=0,l=0,o="",a="";n<e.length;)switch(e[n][0]){case 1:l++,a+=e[n][1],n++;break;case -1:i++,o+=e[n][1],n++;break;case 0:i+l>1?(0!==i&&0!==l&&(0!==(t=this.diff_commonPrefix(a,o))&&(n-i-l>0&&0==e[n-i-l-1][0]?e[n-i-l-1][1]+=a.substring(0,t):(e.splice(0,0,new r.Diff(0,a.substring(0,t))),n++),a=a.substring(t),o=o.substring(t)),0!==(t=this.diff_commonSuffix(a,o))&&(e[n][1]=a.substring(a.length-t)+e[n][1],a=a.substring(0,a.length-t),o=o.substring(0,o.length-t))),n-=i+l,e.splice(n,i+l),o.length&&(e.splice(n,0,new r.Diff(-1,o)),n++),a.length&&(e.splice(n,0,new r.Diff(1,a)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,l=0,i=0,o="",a=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),s=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(e)},r.prototype.diff_xIndex=function(e,t){var n,r=0,i=0,l=0,o=0;for(n=0;n<e.length&&(1!==e[n][0]&&(r+=e[n][1].length),-1!==e[n][0]&&(i+=e[n][1].length),!(r>t));n++)l=r,o=i;return e.length!=n&&-1===e[n][0]?o:o+(t-l)},r.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,r=/</g,i=/>/g,l=/\n/g,o=0;o<e.length;o++){var a=e[o][0],s=e[o][1].replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(l,"&para;<br>");switch(a){case 1:t[o]='<ins style="background:#e6ffe6;">'+s+"</ins>";break;case -1:t[o]='<del style="background:#ffe6e6;">'+s+"</del>";break;case 0:t[o]="<span>"+s+"</span>"}}return t.join("")},r.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},r.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},r.prototype.diff_levenshtein=function(e){for(var t=0,n=0,r=0,i=0;i<e.length;i++){var l=e[i][0],o=e[i][1];switch(l){case 1:n+=o.length;break;case -1:r+=o.length;break;case 0:t+=Math.max(n,r),n=0,r=0}}return t+Math.max(n,r)},r.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case -1:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},r.prototype.diff_fromDelta=function(e,t){for(var n=[],i=0,l=0,o=t.split(/\t/g),a=0;a<o.length;a++){var s=o[a].substring(1);switch(o[a].charAt(0)){case"+":try{n[i++]=new r.Diff(1,decodeURI(s))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var c=parseInt(s,10);if(isNaN(c)||c<0)throw Error("Invalid number in diff_fromDelta: "+s);var h=e.substring(l,l+=c);"="==o[a].charAt(0)?n[i++]=new r.Diff(0,h):n[i++]=new r.Diff(-1,h);break;default:if(o[a])throw Error("Invalid diff operation in diff_fromDelta: "+o[a])}}if(l!=e.length)throw Error("Delta length ("+l+") does not equal source text length ("+e.length+").");return n},r.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw Error("Null input. (match_main)");return(n=Math.max(0,Math.min(n,e.length)),e==t)?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},r.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var r,i,l,o=this.match_alphabet_(t),a=this;function s(e,r){var i=e/t.length,l=Math.abs(n-r);return a.Match_Distance?i+l/a.Match_Distance:l?1:i}var c=this.Match_Threshold,h=e.indexOf(t,n);-1!=h&&(c=Math.min(s(0,h),c),-1!=(h=e.lastIndexOf(t,n+t.length))&&(c=Math.min(s(0,h),c)));var f=1<<t.length-1;h=-1;for(var d=t.length+e.length,p=0;p<t.length;p++){for(r=0,i=d;r<i;)s(p,n+i)<=c?r=i:d=i,i=Math.floor((d-r)/2+r);d=i;var u=Math.max(1,n-i+1),g=Math.min(n+i,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<p)-1;for(var y=g;y>=u;y--){var k=o[e.charAt(y-1)];if(0===p?m[y]=(m[y+1]<<1|1)&k:m[y]=(m[y+1]<<1|1)&k|((l[y+1]|l[y])<<1|1)|l[y+1],m[y]&f){var v=s(p,y-1);if(v<=c){if(c=v,(h=y-1)>n)u=Math.max(1,2*n-h);else break}}}if(s(p+1,n)>c)break;l=m}return h},r.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},r.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin;var l=t.substring(e.start2-i,e.start2);l&&e.diffs.unshift(new r.Diff(0,l));var o=t.substring(e.start2+e.length1,e.start2+e.length1+i);o&&e.diffs.push(new r.Diff(0,o)),e.start1-=l.length,e.start2-=l.length,e.length1+=l.length+o.length,e.length2+=l.length+o.length}},r.prototype.patch_make=function(e,t,n){if("string"==typeof e&&"string"==typeof t&&void 0===n)i=e,(l=this.diff_main(i,t,!0)).length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&void 0===t&&void 0===n)l=e,i=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===n)i=e,l=t;else if("string"==typeof e&&"string"==typeof t&&n&&"object"==typeof n)i=e,l=n;else throw Error("Unknown call format to patch_make.");if(0===l.length)return[];for(var i,l,o=[],a=new r.patch_obj,s=0,c=0,h=0,f=i,d=i,p=0;p<l.length;p++){var u=l[p][0],g=l[p][1];switch(s||0===u||(a.start1=c,a.start2=h),u){case 1:a.diffs[s++]=l[p],a.length2+=g.length,d=d.substring(0,h)+g+d.substring(h);break;case -1:a.length1+=g.length,a.diffs[s++]=l[p],d=d.substring(0,h)+d.substring(h+g.length);break;case 0:g.length<=2*this.Patch_Margin&&s&&l.length!=p+1?(a.diffs[s++]=l[p],a.length1+=g.length,a.length2+=g.length):g.length>=2*this.Patch_Margin&&s&&(this.patch_addContext_(a,f),o.push(a),a=new r.patch_obj,s=0,f=d,c=h)}1!==u&&(c+=g.length),-1!==u&&(h+=g.length)}return s&&(this.patch_addContext_(a,f),o.push(a)),o},r.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],l=new r.patch_obj;l.diffs=[];for(var o=0;o<i.diffs.length;o++)l.diffs[o]=new r.Diff(i.diffs[o][0],i.diffs[o][1]);l.start1=i.start1,l.start2=i.start2,l.length1=i.length1,l.length2=i.length2,t[n]=l}return t},r.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var r=0,i=[],l=0;l<e.length;l++){var o=e[l].start2+r,a=this.diff_text1(e[l].diffs),s=-1;if(a.length>this.Match_MaxBits?-1!=(h=this.match_main(t,a.substring(0,this.Match_MaxBits),o))&&(-1==(s=this.match_main(t,a.substring(a.length-this.Match_MaxBits),o+a.length-this.Match_MaxBits))||h>=s)&&(h=-1):h=this.match_main(t,a,o),-1==h)i[l]=!1,r-=e[l].length2-e[l].length1;else if(i[l]=!0,r=h-o,f=-1==s?t.substring(h,h+a.length):t.substring(h,s+this.Match_MaxBits),a==f)t=t.substring(0,h)+this.diff_text2(e[l].diffs)+t.substring(h+a.length);else{var c=this.diff_main(a,f,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(c)/a.length>this.Patch_DeleteThreshold)i[l]=!1;else{this.diff_cleanupSemanticLossless(c);for(var h,f,d,p=0,u=0;u<e[l].diffs.length;u++){var g=e[l].diffs[u];0!==g[0]&&(d=this.diff_xIndex(c,p)),1===g[0]?t=t.substring(0,h+d)+g[1]+t.substring(h+d):-1===g[0]&&(t=t.substring(0,h+d)+t.substring(h+this.diff_xIndex(c,p+g[1].length))),-1!==g[0]&&(p+=g[1].length)}}}}return[t=t.substring(n.length,t.length-n.length),i]},r.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;i<=t;i++)n+=String.fromCharCode(i);for(var i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;var l=e[0],o=l.diffs;if(0==o.length||0!=o[0][0])o.unshift(new r.Diff(0,n)),l.start1-=t,l.start2-=t,l.length1+=t,l.length2+=t;else if(t>o[0][1].length){var a=t-o[0][1].length;o[0][1]=n.substring(o[0][1].length)+o[0][1],l.start1-=a,l.start2-=a,l.length1+=a,l.length2+=a}if(0==(o=(l=e[e.length-1]).diffs).length||0!=o[o.length-1][0])o.push(new r.Diff(0,n)),l.length1+=t,l.length2+=t;else if(t>o[o.length-1][1].length){var a=t-o[o.length-1][1].length;o[o.length-1][1]+=n.substring(0,a),l.length1+=a,l.length2+=a}return n},r.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var i=e[n];e.splice(n--,1);for(var l=i.start1,o=i.start2,a="";0!==i.diffs.length;){var s=new r.patch_obj,c=!0;for(s.start1=l-a.length,s.start2=o-a.length,""!==a&&(s.length1=s.length2=a.length,s.diffs.push(new r.Diff(0,a)));0!==i.diffs.length&&s.length1<t-this.Patch_Margin;){var h=i.diffs[0][0],f=i.diffs[0][1];1===h?(s.length2+=f.length,o+=f.length,s.diffs.push(i.diffs.shift()),c=!1):-1===h&&1==s.diffs.length&&0==s.diffs[0][0]&&f.length>2*t?(s.length1+=f.length,l+=f.length,c=!1,s.diffs.push(new r.Diff(h,f)),i.diffs.shift()):(f=f.substring(0,t-s.length1-this.Patch_Margin),s.length1+=f.length,l+=f.length,0===h?(s.length2+=f.length,o+=f.length):c=!1,s.diffs.push(new r.Diff(h,f)),f==i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(f.length))}a=(a=this.diff_text2(s.diffs)).substring(a.length-this.Patch_Margin);var d=this.diff_text1(i.diffs).substring(0,this.Patch_Margin);""!==d&&(s.length1+=d.length,s.length2+=d.length,0!==s.diffs.length&&0===s.diffs[s.diffs.length-1][0]?s.diffs[s.diffs.length-1][1]+=d:s.diffs.push(new r.Diff(0,d))),c||e.splice(++n,0,s)}}},r.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},r.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),i=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<n.length;){var o=n[i].match(l);if(!o)throw Error("Invalid patch string: "+n[i]);var a=new r.patch_obj;for(t.push(a),a.start1=parseInt(o[1],10),""===o[2]?(a.start1--,a.length1=1):"0"==o[2]?a.length1=0:(a.start1--,a.length1=parseInt(o[2],10)),a.start2=parseInt(o[3],10),""===o[4]?(a.start2--,a.length2=1):"0"==o[4]?a.length2=0:(a.start2--,a.length2=parseInt(o[4],10)),i++;i<n.length;){var s=n[i].charAt(0);try{var c=decodeURI(n[i].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+c)}if("-"==s)a.diffs.push(new r.Diff(-1,c));else if("+"==s)a.diffs.push(new r.Diff(1,c));else if(" "==s)a.diffs.push(new r.Diff(0,c));else if("@"==s)break;else if(""===s);else throw Error('Invalid patch mode "'+s+'" in: '+c);i++}}return t},r.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},r.patch_obj.prototype.toString=function(){e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;for(var e,t,n=["@@ -"+e+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],r=0;r<this.diffs.length;r++){switch(this.diffs[r][0]){case 1:t="+";break;case -1:t="-";break;case 0:t=" "}n[r+1]=t+encodeURI(this.diffs[r][1])+"\n"}return n.join("").replace(/%20/g," ")},eu.exports=r,eu.exports.diff_match_patch=r,eu.exports.DIFF_DELETE=-1,eu.exports.DIFF_INSERT=1,eu.exports.DIFF_EQUAL=0;var eg=eu.exports;function em(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"setIfMissing",path:t,value:e}}let ey=new eg.diff_match_patch;function ek(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=ey.patch_make(e,t).map(e=>e.toString()).join("");return{type:"diffMatchPatch",path:n,value:r}}function ev(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{type:"insert",path:n,position:t,items:e}}function e_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"set",path:t,value:e}}function eb(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:"unset",path:e}}let ex=[];function ew(e,t){let n=t[e._key];return n&&R()(e,n)?n:(t[e._key]=e,e)}function eM(e,t){let{schemaTypes:n}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e&&Array.isArray(e)?e.map(e=>{let{_type:t,_key:i,...l}=e,o=[{_key:"".concat(i,"-void-child"),_type:"span",text:"",marks:[]}],a=e&&e._type===n.block.name;if(a){let a=!1,s=void 0===e.style,c=void 0===e.markDefs,h=e.children.map(e=>{let{_type:t,_key:n,...i}=e;return"span"!==t?(a=!0,ew({_type:t,_key:n,children:o,value:i,__inline:!0},r)):e});return!s&&!c&&!a&&x.W_.isElement(e)?e:(s&&(l.style=n.styles[0].value),c&&(l.markDefs=ex),ew({_type:t,_key:i,...l,children:h},r))}return ew({_type:t,_key:i,children:o,value:l},r)}):[]}function eE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.map(e=>{let{_key:r,_type:i}=e;if(!r||!i)throw Error("Not a valid block");if(i===t&&"children"in e&&Array.isArray(e.children)&&r){let t=!1,l=e.children.map(e=>{let{_type:r}=e;if("value"in e&&"span"!==r){t=!0;let{value:r,_key:i,_type:l,__inline:o,children:a,...s}=e;return ew({...s,...r,_key:i,_type:l},n)}return e});return t?ew({...e,children:l,_key:r,_type:i},n):e}let l="value"in e&&e.value;return ew({_key:r,_type:i,..."object"==typeof l?l:{}},n)})}function eN(e,t){var n;return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&x.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&x.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!(null==(n=e[0].children[0].marks)?void 0:n.join(""))&&""===e[0].children[0].text}let eT=er("operationToPatches");function eD(e,t,n){let r;let i=[e.path[0]];if(!t)return null;let l=t[i[0]];if(!l)return null;let o=[{_key:l._key}];if(l._type!==n.block.name)return o;let a=e.path.slice(0,2),s=Array.isArray(l.children)&&l.children[a[1]];return s&&(r=["children",{_key:s._key}]),r?[...o,...r]:o}function eA(e,t){if(!t)return[];let[n,r]=Array.from(x.ML.nodes(t,{at:[],match:t=>(0,I.Fd)(e.path[0])&&t._key===e.path[0]._key}))[0]||[void 0,void 0];if(!n||!x.W_.isElement(n))return[];if(t.isVoid(n))return r;let i=[e.path[2]],l=n.children.findIndex(e=>R()([{_key:e._key}],i));if(l>=0&&n.children[l]){let e=n.children[l];return x.W_.isElement(e)&&t.isVoid(e)?r.concat(l).concat(0):r.concat(l)}return r}function eC(e,t,n){if(!t)return null;let r=null,i=null,l=t.anchor&&eD(t.anchor,e,n);l&&t.anchor&&(r={path:l,offset:t.anchor.offset});let o=t.focus&&eD(t.focus,e,n);return o&&t.focus&&(i={path:o,offset:t.focus.offset}),r&&i?{anchor:r,focus:i}:null}function eS(e,t){if(!e||!t)return null;let n={path:eA(e.anchor,t),offset:e.anchor.offset},r={path:eA(e.focus,t),offset:e.focus.offset};return n&&r?{anchor:n,focus:r}:null}let eL=er("API:editable"),eP=new WeakMap;function eR(e,t){eP.set(e,!0),t(),eP.set(e,!1)}let eI=new WeakMap;function eB(e,t){let n=eI.get(e);eI.set(e,!1),t(),eI.set(e,n)}let ej="before",eO="after";function eY(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e.concat(t),[])}let eW=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),ez={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},inc:(e,t)=>e+t,dec:(e,t)=>e-t},eJ=Object.keys(ez),eV=new eg.diff_match_patch,eF={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},diffMatchPatch:(e,t)=>eV.patch_apply(eV.patch_fromText(t),e)[0]},eU=Object.keys(eF),e$=er("patchToOperations"),eH=new eg.diff_match_patch;function eq(e){return"object"==typeof e&&"_key"in e}function eZ(e){let t=null;return e.concat("").reverse().forEach(e=>{eq(e)&&(t=e._key)}),t}function eG(e,t){e$("Children ".concat(t,":"),JSON.stringify(e.children,null,2)),e$("Selection ".concat(t,": "),JSON.stringify(e.selection,null,2))}let eK=er("plugin:withUndoRedo"),eX=new eg.diff_match_patch,eQ=new WeakMap,e0=new WeakMap,e1=e=>e0.get(e),e2=e=>!!eI.get(e)&&eQ.get(e);function e3(e,t,n){let r={...n};if("insert"===t.type&&1===t.path.length)return[e6(e,t,n,t.items.length)];if("unset"===t.type&&1===t.path.length)return[e6(e,t,n,-1)];if("unset"===t.type&&0===t.path.length)return eK("Adjusting selection for unset everything patch and ".concat(n.type," operation")),[n];if("diffMatchPatch"===t.type){let i=e.children.findIndex(e=>R()({_key:e._key},t.path[0])),l=e.children[i];if(x.W_.isElement(l)&&Array.isArray(l.children)){let e=l.children.findIndex(e=>R()({_key:e._key},t.path[2])),o=eX.patch_fromText(t.value)[0];if(!o)return eK("Could not parse diffMatchPatch",t),[n];let a=o.length2-o.length1,s=o.diffs.some(e=>-1===e[0]);if("split_node"===n.type&&n.path.length>1){let e=r;return s?e.position-=a:e.position+=a,[e]}if(("insert_text"===n.type||"remove_text"===n.type)&&x.y$.isPath(n.path)&&void 0!==n.path[0]&&n.path[0]===i&&n.path[1]===e){if("insert_text"===n.type){let e=0;for(let t of o.diffs)if(0===t[0]&&(e=t[1].length),1===t[0])break;if(null!==o.start1&&e+o.start1<=n.offset){let e=r;e.offset+=a,r=e}return[r]}if("remove_text"===n.type){let e=0;for(let t of o.diffs)if(0===t[0]&&(e=t[1].length),-1===t[0])break;if(null!==o.start1&&e+o.start1<=n.offset){let e=r;e.offset-=a,r=e}return[r]}}}}return[n]}function e6(e,t,n,r){let i=e.children.findIndex(e=>R()({_key:e._key},t.path[0]));if(i>=0&&"set_selection"!==n.type&&Array.isArray(n.path)&&void 0!==n.path[0]&&n.path[0]>=i+r){let e={...n},i=[n.path[0]+r,...n.path.slice(1)];return eK("Adjusting ".concat(n.type," for block ").concat(t.type),n.path,i),e.path=i,e}return n}let e4=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&x.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&x.y$.equals(e.path,t.path)),e7=(e,t)=>"set_selection"!==e.type||null!==e.newProperties,e5=(e,t)=>!!t&&"set_selection"===e.type&&"set_selection"===t.type,e9=e=>"set_selection"!==e.type;function e8(e,t){let n=e2(e);eQ.set(e,!1),t(),eQ.set(e,n)}let te=er("plugin:withPatches"),tt=er("plugin:withPlaceholderBlock"),tn=er("plugin:withPortableTextBlockStyle"),tr=er("plugin:withPortableTextLists"),ti=er("plugin:withPortableTextMarkModel"),tl=er("plugin:withPortableTextSelections"),to=er("plugin:withSchemaTypes"),ta=er("plugin:withUtils"),ts=er("plugin:withHotKeys"),tc={marks:{"mod+b":"strong","mod+i":"em","mod+u":"underline","mod+'":"code"},custom:{}};function th(e,t,n){let r=null,i=!0,l=[t.span.name,...t.inlineObjects.map(e=>e.name)],o=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,a)=>{if(!j()(e))return r={patches:[eb([a])],description:"Block must be an object, got ".concat(String(e)),action:"Unset invalid item",item:e},!0;if(!e._key)return r={patches:[e_({...e,_key:n()},[a])],description:"Block at index ".concat(a," is missing required _key."),action:"Set the block with a random _key value",item:e},!0;if(!e._type||!o.includes(e._type)){if("block"===e._type){let n=t.block.name;return r={patches:[e_({...e,_type:n},[{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid type name '").concat(e._type,"'. According to the schema, the block type name is '").concat(n,"'"),action:"Use type '".concat(n,"'"),item:e},!0}return r={patches:[eb([{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid _type '").concat(e._type,"'"),action:"Remove the block",item:e},!0}if(e._type===t.block.name){if(!e.children)return r={patches:[eb([{_key:e._key}])],description:"Text block with _key '".concat(e._key,"' is missing required key 'children'."),action:"Remove the block",item:e},!0;if(!e.markDefs)return r={patches:[e_({...e,markDefs:[]},[{_key:e._key}])],description:"Block is missing required key 'markDefs'.",action:"Add empty markDefs array",item:e},!0;let o=H()(L()(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[]))),a=o.filter(e=>!t.decorators.map(e=>e.value).includes(e)),s=a.filter(t=>!!e.markDefs&&!e.markDefs.find(e=>e._key===t));if(s.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>s.includes(e)));if(n)return r={patches:n.map(t=>e_((t.marks||[]).filter(e=>!s.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:"Block with _key '".concat(e._key,"' contains marks (").concat(s.join(", "),") not supported by the current content model."),action:"Remove invalid marks",item:e},!0}if(e.children&&0===e.children.length){let i={_type:t.span.name,_key:n(),text:""};return r={patches:[ev([i],"after",[{_key:e._key},"children",0])],description:"Children for text block with _key '".concat(e._key,"' is empty."),action:"Insert an empty text",item:e},!0}e.children.some((i,o)=>{if(!i._key){let t={...i,_key:n()};return r={patches:[e_(t,[{_key:e._key},"children",o])],description:"Child at index ".concat(o," is missing required _key in block with _key ").concat(e._key,"."),action:"Set a new random _key on the object",item:e},!0}return i._type&&!1!==l.includes(i._type)?i._type===t.span.name&&void 0===i.text&&(r={patches:[e_({...i,text:""},[{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' is missing text property!"),action:"Write an empty .text to the object",item:e},!0):(r={patches:[eb([{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' has invalid '_type' property (").concat(i._type,")."),action:"Remove the object",item:e},!0)})&&(i=!1)}return!1})&&(i=!1),{valid:i,resolution:r,value:e}):{valid:!1,resolution:{patches:[eb([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e},value:e}}let tf=er("plugin:withInsertData"),td={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function tp(e,t,n){if(!e.selection)return;let[r,i]=x.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(r)&&e.isTextBlock(t[0])){let{markDefs:n}=r;tf("Mixing markDefs of focusBlock and fragments[0] block",n,t[0].markDefs),R()(n,t[0].markDefs)||x.YR.setNodes(e,{markDefs:H()([...t[0].markDefs||[],...n||[]])},{at:i,mode:"lowest",voids:!1})}let l=eN(e.children,n);l?(x.YR.splitNodes(e,{at:[0,0]}),e.insertFragment(t),x.YR.removeNodes(e,{at:[0]})):e.insertFragment(t),e.onChange()}let tu=new WeakMap,tg=(e,t)=>{var n;let r;let{keyGenerator:i,portableTextEditor:l,patches$:o,readOnly:a,maxBlocks:s,isPending:c}=t,{schemaTypes:m,change$:y}=l;e.subscriptions=[],e.destroy?e.destroy():tu.set(e,{apply:e.apply,onChange:e.onChange,normalizeNode:e.normalizeNode});let k=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,r){let i=r[n.path[0]],l=e.isTextBlock(i);if(1===n.path.length){let e=0===n.path[0]?"before":"after",l=r[n.path[0]-1],o=0===n.path[0]?null==i?void 0:i._key:null==l?void 0:l._key;return o?[ev([eE([n.node],t)[0]],e,[{_key:o}])]:[em(r,[]),ev([eE([n.node],t)[0]],"before",[n.path[0]])]}if(l&&2===n.path.length&&e.children[n.path[0]]){let e=0!==i.children.length&&i.children[n.path[1]-1]?"after":"before",r=eE([{_key:"bogus",_type:t,children:[n.node]}],t)[0],l=r.children[0];return[ev([l],e,[{_key:i._key},"children",i.children.length<=1||!i.children[n.path[1]-1]?0:{_key:i.children[n.path[1]-1]._key}])]}return eT("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){eT("Operation",JSON.stringify(t,null,2));let r=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&e.isTextSpan(r.children[t.path[1]])&&r.children[t.path[1]];if(!i)throw Error("Could not find child");let l=[{_key:r._key},"children",{_key:i._key},"text"],o=n[t.path[0]],a=e.isTextBlock(o)&&o.children[t.path[1]],s=e.isTextSpan(a)?a.text:"",c=ek(s,i.text,l);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,r){let i=[],l=r[n.path[0]],o=e.children[n.path[0]];if(1===n.path.length){if(null==l?void 0:l._key){let r=eE([e.children[n.path[0]-1]],t)[0];i.push(e_(r,[{_key:r._key}])),i.push(eb([{_key:l._key}]))}else throw Error("Target key not found!")}else if(2===n.path.length&&e.isTextBlock(o)){let t=e.isTextBlock(l)&&l.children[n.path[1]]||void 0,r=o.children[n.path[1]-1];e.isTextSpan(r)&&(i.push(e_(r.text,[{_key:l._key},"children",{_key:r._key},"text"])),t&&i.push(eb([{_key:l._key},"children",{_key:t._key}])))}else eT("Void nodes can't be merged, not creating any patches");return i},moveNodePatch:function(e,n,r){let i=[],l=r[n.path[0]],o=r[n.newPath[0]];if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";i.push(eb([{_key:l._key}])),i.push(ev([eE([l],t)[0]],e,[{_key:o._key}]))}else if(2===n.path.length&&e.isTextBlock(l)&&e.isTextBlock(o)){let e=l.children[n.path[1]],r=o.children[n.newPath[1]],a=n.newPath[1]===o.children.length?"after":"before",s=eE([l],t)[0].children[n.path[1]];i.push(eb([{_key:l._key},"children",{_key:e._key}])),i.push(ev([s],a,[{_key:o._key},"children",{_key:r._key}]))}return i},removeNodePatch:function(e,t,n){let r=n[t.path[0]];if(1===t.path.length){if(r&&r._key)return[eb([{_key:r._key}])];throw Error("Block not found")}if(!e.isTextBlock(r)||2!==t.path.length)return eT("Not creating patch inside object block"),[];{let n=e.isTextBlock(r)&&r.children&&r.children[t.path[1]];return n?[eb([{_key:r._key},"children",{_key:n._key}])]:(eT("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let r=e&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&r.children[t.path[1]]||void 0,l=e.isTextSpan(i)?i:void 0;if(i&&!l)throw Error("Expected span");if(!l)throw Error("Could not find child");let o=[{_key:r._key},"children",{_key:l._key},"text"],a=n[t.path[0]],s=e.isTextBlock(a)&&a.children[t.path[1]],c=e.isTextSpan(s)&&s.text,h=ek(c||"",l.text,o);return h.value?[h]:[]},setNodePatch:function(e,n){if(1===n.path.length){let r=e.children[n.path[0]];if("string"!=typeof r._key)throw Error("Expected block to have a _key");let i=N()({...e.children[n.path[0]],...n.newProperties},D());return[e_(eE([i],t)[0],[{_key:r._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let r=t._key,i=e._key,l=[];return Object.keys(n.newProperties).forEach(e=>{let t=C()(n.newProperties,e);l.push(e_(t,[{_key:r},"children",{_key:i},e]))}),l}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)))},splitNodePatch:function(e,n,r){let i=[],l=e.children[n.path[0]];if(!e.isTextBlock(l))throw Error("Block with path ".concat(JSON.stringify(n.path[0])," is not a text block and can't be split"));if(1===n.path.length){let o=r[n.path[0]];if(e.isTextBlock(o)){let r=eE([e.children[n.path[0]+1]],t)[0];if(r){i.push(ev([r],"after",[{_key:l._key}]));let e=o.children.slice(n.position);e.forEach(e=>{let t=[{_key:o._key},"children",{_key:e._key}];i.push(eb(t))})}}return i}if(2===n.path.length){let r=l.children[n.path[1]];if(e.isTextSpan(r)){let e=eE([{...l,children:l.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;i.push(ev(e,"after",[{_key:l._key},"children",{_key:r._key}])),i.push(e_(r.text,[{_key:l._key},"children",{_key:r._key},"text"]))}}return i}}}(m),v=function(e){eP.set(e,!1);let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if("split_node"===n.type&&(n.properties={...n.properties,_key:i()}),"insert_node"===n.type){let t=!eP.get(e)||!("_key"in n.node);x.ML.isEditor(n.node)||(n.node={...n.node,...t?{_key:i()}:{}})}t(n)},e.normalizeNode=t=>{let[r,l]=t;if(x.W_.isElement(r)&&r._type===m.block.name){for(let[t,n]of(r._key||x.YR.setNodes(e,{_key:i()},{at:l}),x.NB.children(e,l)))if(!t._key){x.YR.setNodes(e,{_key:i()},{at:n});return}}n(t)},e},_=function(e){e.isTextBlock=e=>(0,I.DG)(e)&&e._type===m.block.name,e.isTextSpan=e=>(0,I.NG)(e)&&e._type==m.span.name,e.isListBlock=e=>(0,I.KA)(e)&&e._type===m.block.name,e.isVoid=e=>m.block.name!==e._type&&(m.blockObjects.map(e=>e.name).includes(e._type)||m.inlineObjects.map(e=>e.name).includes(e._type)),e.isInline=e=>{let t=m.inlineObjects.map(e=>e.name);return t.includes(e._type)&&"__inline"in e&&!0===e.__inline};let{apply:t}=e;return e.apply=e=>{let n="insert_node"===e.type&&2===e.path.length&&x.xv.isText(e.node)&&void 0===e.node._type;if(n){let t={...e.node,_type:"span"};e.node=t,to("Setting span type to child without a type",e)}t(e)},e},w=function(e){return l.setEditable({focus:()=>{if(!e.selection){let t={path:[0,0],offset:0};x.YR.select(e,{focus:t,anchor:t}),e.onChange()}b.F3.focus(e)},blur:()=>{b.F3.blur(e)},toggleMark:t=>{e.pteToggleMark(t)},toggleList:t=>{e.pteToggleListItem(t)},toggleBlockStyle:t=>{e.pteToggleBlockStyle(t)},isMarkActive:t=>{try{return e.pteIsMarkActive(t)}catch(e){return console.warn(e),!1}},marks:()=>({...x.ML.marks(e)||{}}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=eS(t,e);n?x.YR.select(e,n):x.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection)try{let[t]=Array.from(x.ML.nodes(e,{at:e.selection.focus,match:t=>x.ML.isBlock(e,t)}))[0]||[void 0];if(t)return eE([t],m.block.name,ed.get(e))[0]}catch(e){}},focusChild:()=>{if(e.selection)try{let[t]=Array.from(x.ML.nodes(e,{mode:"lowest",at:e.selection.focus,match:e=>void 0!==e._type,voids:!0}))[0]||[void 0];if(t&&!x.ML.isBlock(e,t)){let n={_key:"pseudo",_type:m.block.name,children:[t]},r=eE([n],m.block.name,ed.get(e));if(e.isTextBlock(r[0]))return r[0].children[0]}}catch(e){}},insertChild:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let[o]=Array.from(x.ML.nodes(e,{at:e.selection.focus,match:t=>x.ML.isBlock(e,t)}))[0]||[void 0];if(!o)throw Error("No focus block");if(o&&x.ML.isVoid(e,o))throw Error("Can't insert childs into block objects");let a=eM([{_key:i(),_type:m.block.name,children:[{_key:i(),_type:t.name,...n||{}}]}],l)[0],s=a.children[0];return x.ML.insertNode(e,s),e.onChange(),(null==(r=eC(eE(e.children,m.block.name,ed.get(e)),e.selection,m))?void 0:r.focus.path)||[]},insertBlock:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let o=eM([{_key:i(),_type:t.name,...n||{}}],l)[0];return x.ML.insertNode(e,o),e.onChange(),(null==(r=eC(eE(e.children,m.block.name,ed.get(e)),e.selection,m))?void 0:r.focus.path)||[]},hasBlockStyle:t=>{try{return e.pteHasBlockStyle(t)}catch(e){return!1}},hasListStyle:t=>{try{return e.pteHasListStyle(t)}catch(e){return!1}},isVoid:e=>![m.block.name,m.span.name].includes(e._type),findByPath:t=>{let n=eS({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(n){let[r,i]=x.ML.node(e,n.focus.path.slice(0,1));if(r&&i&&"string"==typeof r._key){if(1===t.length&&1===n.focus.path.length)return[eE([r],m.block.name)[0],[{_key:r._key}]];let i=eE([r],m.block.name,ed.get(e))[0];if(e.isTextBlock(i)){let e=i.children[n.focus.path[1]];if(e)return[e,[{_key:r._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[r]=Array.from(x.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=b.F3.toDOMNode(e,r)}catch(e){}return n},activeAnnotations:()=>{var t;if(!e.selection||e.selection.focus.path.length<2)return[];try{let n=[],r=x.ML.nodes(e,{at:e.selection,match:e=>x.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0});for(let[i,l]of r){let[r]=x.ML.node(e,l,{depth:1});e.isTextBlock(r)&&(null==(t=r.markDefs)||t.forEach(e=>{x.xv.isText(i)&&i.marks&&Array.isArray(i.marks)&&i.marks.includes(e._key)&&n.push(e)}))}return n}catch(e){return[]}},addAnnotation:(t,n)=>{let{selection:r}=e;if(r){let[l]=x.ML.node(e,r.focus,{depth:1});if(x.W_.isElement(l)&&l._type===m.block.name){let o=i();if(e.isTextBlock(l)){x.YR.setNodes(e,{markDefs:[...l.markDefs||[],{_type:t.name,_key:o,...n}]},{at:r.focus}),e.onChange(),x.e6.isCollapsed(r)&&(e.pteExpandToWord(),e.onChange());let[a]=x.ML.node(e,r.focus,{depth:2});if(e.selection){x.ML.withoutNormalizing(e,()=>{x.YR.setNodes(e,{},{match:x.xv.isText,split:!0}),e.selection&&x.xv.isText(a)&&(x.YR.setNodes(e,{marks:[...a.marks||[],o]},{at:e.selection,match:e=>e._type===m.span.name}),e.onChange())}),x.ML.normalize(e),e.onChange();let t=eC(eE(e.children,m.block.name,ed.get(e)),e.selection,m);if(t&&"string"==typeof l._key)return x.ML.withoutNormalizing(e,()=>{e.selection&&(x.YR.insertNodes(e,[{_type:"span",text:"",marks:[],_key:i()}],{at:x.e6.end(e.selection)}),e.onChange())}),{spanPath:t.focus.path,markDefPath:[{_key:l._key},"markDefs",{_key:o}]}}}}}},delete:(t,n)=>{if(t){let r=eS(t,e);if(r){if(!(null==n?void 0:n.mode)||(null==n?void 0:n.mode)==="selected"){eL("Deleting content in selection"),x.YR.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}let t=x.ML.nodes(e,{at:r,match:t=>(null==n?void 0:n.mode)==="blocks"?(eL("Deleting blocks touched by selection"),e.isTextBlock(t)||!e.isTextBlock(t)&&x.W_.isElement(t)):(eL("Deleting children touched by selection"),t._type===m.span.name||!e.isTextBlock(t)&&x.W_.isElement(t))}),i=[...t];i.forEach(t=>{let[,n]=t;x.YR.removeNodes(e,{at:n,voids:!0,hanging:!0})}),e.onChange()}}},removeAnnotation:t=>{let{selection:n}=e;if(eL("Removing annotation",t),n){if(x.e6.isCollapsed(n)){let[t,r]=x.ML.node(e,n,{depth:2});x.xv.isText(t)&&t.marks&&"string"==typeof t.text&&(x.YR.select(e,r),n=e.selection)}x.ML.withoutNormalizing(e,()=>{if(n&&x.e6.isExpanded(n)){if(!(n=e.selection))return;x.YR.setNodes(e,{},{match:x.xv.isText,split:!0}),e.onChange();let r=[...x.ML.nodes(e,{at:n,match:e=>x.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})];r.forEach(n=>{var r;let[i,l]=n,[o]=x.ML.node(e,l,{depth:1});e.isTextBlock(o)&&(null==(r=o.markDefs)||r.filter(e=>e._type===t.name).forEach(t=>{if(x.xv.isText(i)&&Array.isArray(i.marks)&&i.marks.includes(t._key)){let n=[...(i.marks||[]).filter(e=>e!==t._key)];x.YR.setNodes(e,{marks:n},{at:l,voids:!1,split:!1})}}))})}}),x.ML.normalize(e),e.onChange()}},getSelection:()=>{let t=null;if(e.selection){let n=ep.get(e.selection);if(n)return n;t=eC(eE(e.children,m.block.name,ed.get(e)),e.selection,m),ep.set(e.selection,t)}return t},getValue:()=>eE(e.children,m.block.name,ed.get(e)),isCollapsedSelection:()=>!!e.selection&&x.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&x.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()}}),e},E=function(e){let t,n,{change$:r,isPending:i,patches$:l,patchFunctions:o,readOnly:a,schemaTypes:s}=e,c=function(e,n){let r=!1;e$("\n\nNEW PATCH ============================================================="),e$(JSON.stringify(n,null,2));try{switch(n.type){case"insert":r=function(e,t){if(1===t.path.length){let{items:n,position:r}=t,i=eM(n,{schemaTypes:s},ef.get(e)),l=eZ(t.path),o=Math.max(0,e.children.findIndex((e,n)=>l?e._key===l:n===t.path[0])),a="after"===r?o+1:o;return e$("Inserting blocks at path [".concat(a,"]")),eG(e,"before"),x.YR.insertNodes(e,i,{at:[a]}),eG(e,"after"),!0}let{items:n,position:r}=t,i=eZ(t.path),l=e.children.findIndex((e,n)=>i?e._key===i:n===t.path[0]),o=e.children&&l>-1?e.children[l]:void 0,a=e.isTextBlock(o)?o.children.findIndex((e,n)=>eq(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,c=o&&eM([{...o,children:n}],{schemaTypes:s},ef.get(e)),h=[l,"after"===r?a+1:a];return e$("Inserting children at path ".concat(h)),eG(e,"before"),c&&x.W_.isElement(c[0])&&x.YR.insertNodes(e,c[0].children,{at:h}),eG(e,"after"),!0}(e,n);break;case"unset":r=function(e,t,n){var r;if(0===t.path.length){e$("Removing everything"),eG(e,"before");let t=e.selection;return x.YR.deselect(e),e.children.forEach((t,n)=>{x.YR.removeNodes(e,{at:[n]})}),x.YR.insertNodes(e,e.createPlaceholderBlock()),t&&x.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),eG(e,"after"),!0}if(1===t.path.length){let n=eZ(t.path),r=e.children.findIndex((e,r)=>n?e._key===n:r===t.path[0]);if(-1===r)return e$("Could not find block to unset at path ".concat(JSON.stringify(t.path))),!1;if(e$("Removing block at path [".concat(r,"]")),eG(e,"before"),e.selection&&e.selection.focus.path[0]===r&&e.children[r-1]){let t={path:[Math.max(e.selection.focus.path[0]-1,0)],offset:0};x.YR.select(e,{focus:t,anchor:t}),x.YR.move(e,{unit:"line"})}return x.YR.removeNodes(e,{at:[r]}),eG(e,"after"),!0}let i=e.children.findIndex((e,n)=>eq(t.path[0])?e._key===t.path[0]._key:n===t.path[0]),l=i>-1?e.children[i]:void 0;if(e.isTextBlock(l)&&"children"===t.path[1]&&3===t.path.length){let o=l.children.findIndex((e,n)=>eq(t.path[2])?e._key===t.path[2]._key:n===t.path[2]),a=[i,o],s=e.selection&&{...e.selection},c=R()(null==(r=e.selection)?void 0:r.focus.path,a);if(-1===o)return e$("Could not find child to unset at path ".concat(JSON.stringify(a))),!1;if(e$("Unsetting child at path ".concat(JSON.stringify(a))),eG(e,"before"),s&&c&&e.isTextBlock(l)){let t=o>=s.focus.path[1];if(t){let t=l.children[o],r=(null==n?void 0:n.type)==="set"&&"text"===n.path[3]&&"string"==typeof n.value&&e.isTextSpan(t)&&R()(n.value.slice(-t.text.length),l.children[o].text);if(r){let n=l.children[Math.max(o-1,0)];return e$("Adjusting selection for merging of nodes"),s.focus={...s.focus},s.focus.path=[a[0],Math.max(a[1]-1,0)],s.focus.offset=e.isTextSpan(n)?n.text.length-t.text.length+s.focus.offset:0,s.anchor=s.focus,x.YR.select(e,s),x.YR.removeNodes(e,{at:[i,o]}),eG(e,"after"),!0}}}return x.YR.removeNodes(e,{at:[i,o]}),eG(e,"after"),!0}return!1}(e,n,t);break;case"set":r=function(e,t){let n=e.children.findIndex((e,n)=>eq(t.path[0])?e._key===t.path[0]._key:n===t.path[0]);e$("blockIndex",n);let r=n>-1?e.children[n]:void 0,i=e.isTextBlock(r);if(i&&t.path.length>2&&"children"!==t.path[1])return e$("Ignoring setting void value"),!1;let l=i?r.children.findIndex((e,n)=>eq(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,o=t.value,a=l>-1?[n,l]:[n];if("string"==typeof t.path[3]&&((o={})[t.path[3]]=t.value),i){if(e$("Setting nodes at ".concat(JSON.stringify(t.path)," - ").concat(JSON.stringify(a))),e$("Value to set",JSON.stringify(o,null,2)),eG(e,"before"),1===a.length){e$("Setting block property");let{children:t,...n}=o,{children:i,...l}=r||{children:void 0};e.apply({type:"set_node",path:a,properties:{...l},newProperties:n}),r&&x.W_.isElement(r)&&r.children.forEach((t,n)=>{e.apply({type:"remove_node",path:a.concat(n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:a.concat(n),node:t})})}else if(x.xv.isText(o)){e$("Setting text property");let t=e.selection&&{...e.selection};e.apply({type:"remove_text",path:a,offset:0,text:r.children[l].text}),e.apply({type:"insert_text",path:a,offset:0,text:o.text});let n=t&&R()(t.focus.path,a);n&&(e$("On same path, restoring previous selection"),x.YR.select(e,t))}else e$("Setting non-text property"),e.apply({type:"set_node",path:a,properties:{},newProperties:o});return eG(e,"after"),!0}if(r&&"value"in r){var s;let i=(s=[r.value],[t].reduce(function e(t,n){let r=Array.isArray(t)?function(t,n){let r=t.slice();if(0===n.path.length){if("setIfMissing"===n.type){if(!Array.isArray(n.value))throw Error("Cannot set value of an array to a non-array");return void 0===t?n.value:t}if("set"===n.type){if(!Array.isArray(n.value))throw Error("Cannot set value of an array to a non-array");return n.value}if("unset"===n.type)return;if("move"===n.type){if(!n.value||!eW(n.value,"from")||!eW(n.value,"to"))throw Error('Invalid value of \'move\' patch. Expected a value with "from" and "to" indexes, instead got: '.concat(JSON.stringify(n.value)));return function(e,t,n){let r=e.slice(),i=r[t];return r.splice(t,1),r.splice(n,0,i),r}(r,n.value.from,n.value.to)}throw Error("Invalid array operation: ".concat(n.type))}let[i,...l]=n.path,o=function(e,t){if("number"==typeof t)return t;let n=z()(e,t);return -1!==n&&n}(t,i);if(!1===o)return r;if(0===l.length){if("insert"===n.type){let{position:e,items:r}=n;return function(e,t,n){if(t!==ej&&t!==eO)throw Error('Invalid position "'.concat(t,'", must be either ').concat(ej," or ").concat(eO));for(var r=arguments.length,i=Array(r>3?r-3:0),l=3;l<r;l++)i[l-3]=arguments[l];let o=eY(...i);if(0===e.length)return o;let a=e.length,s=Math.abs((a+n)%a)%a,c="after"===t?s+1:s,h=e.slice();return h.splice(c,0,...eY(o)),h}(t,e,o,r)}if("unset"===n.type){if("number"!=typeof o)throw Error('Expected array index to be a number, instead got "'.concat(o,'"'));return r.splice(o,1),r}}return r[o]=e(r[o],{...n,path:l}),r}(t,n):Y()(t)?function(e,t){if(!eU.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for string. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on string values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));let n=eF[t.type];if(n)return n(e,t.value);throw Error("Unknown patch type")}(t,n):j()(t)?function(t,n){let r=U()(t);if(0===n.path.length){if("set"===n.type){if(!j()(n.value))throw Error("Cannot set value of an object to a non-object");return n.value}if("unset"===n.type)return;if("setIfMissing"===n.type)return void 0===t?n.value:t;throw Error("Invalid object operation: ".concat(n.type))}let[i,...l]=n.path;if("string"!=typeof i)throw Error("Expected field name to be a string, instad got: ".concat(i));return 0===l.length&&"unset"===n.type?V()(r,i):(r[i]=e(r[i],{...n,path:l}),r)}(t,n):function(e,t){if(!eJ.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for primitives. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on primitive values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.map(e=>JSON.stringify(e)).join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));return ez[t.type](e,t.value)}(t,n);return r},s))[0];return x.YR.setNodes(e,{...r,value:i},{at:[n]}),!0}return!1}(e,n);break;case"diffMatchPatch":r=function(e,t){let n=eZ([t.path[0]]),r=e.children.findIndex((e,r)=>n?e._key===n:r===t.path[0]),i=e.children[r],l=eH.patch_fromText(t.value)[0],o=e.isTextBlock(i)&&"children"===t.path[1]&&4===t.path.length&&"text"===t.path[3];if(l&&o){let n;let o=l.length2-l.length1;if(n=l.diffs[1]?l.diffs[1][1]:l.diffs[0][1],"children"===t.path[1]){let a=eZ([t.path[2]]),s=i.children.findIndex((e,n)=>a?e._key===a:n===t.path[0]),c=[r];s>-1&&c.push(s);let h={path:c,offset:o>=0?(l.start1||0)+l.diffs[0][1].length:(l.start2||0)+l.length2-o};eG(e,"before"),o>=0?e.apply({type:"insert_text",path:h.path,offset:h.offset,text:n}):e.apply({type:"remove_text",path:h.path,offset:h.offset-n.length,text:n})}return eG(e,"after"),!0}return!1}(e,n);break;default:e$("Unhandled patch",n.type)}}catch(e){console.error(e)}return t=n,r};return function(e){eI.set(e,!0),n=[...e.children];let{apply:t}=e;return l&&e.subscriptions.push(()=>{var t;te("Subscribing to patches$");let n=l.pipe((0,f.b)(e=>{let{patches:t}=e;t.every(e=>"local"===e.origin)&&(i.current=!1)}),(t=()=>!i.current,e=>(0,h.P)(()=>{let n=[];return e.pipe((0,f.b)(e=>n.push(e)),(0,d.w)(()=>t(n)?(0,p.of)(n):u.E),(0,f.b)(()=>n=[]))})),(0,g.b)(e=>e)).subscribe(t=>{let{patches:n,snapshot:r}=t,i=n.filter(e=>"local"!==e.origin);0!==i.length&&(te("Remote patches",n),x.ML.withoutNormalizing(e,()=>{i.forEach(t=>{te("Handling remote patch ".concat(JSON.stringify(t))),eB(e,()=>{e8(e,()=>{eR(e,()=>{try{c(e,t,n,r)}catch(e){te("Got error trying to create operations from patch"),console.error(e)}})})})})}))});return()=>{te("Unsubscribing to patches$"),n.unsubscribe()}}),e.apply=i=>{if(a)return t(i),e;let l=[];n=e.children;let c=eN(n,s);t(i);let h=eN(e.children,s);if(!eI.get(e))return te("Editor is not producing patch for operation ".concat(i.type),i),e;switch(c&&!h&&"set_selection"!==i.type&&l.push(ev(n,"before",[0])),i.type){case"insert_text":l=[...l,...o.insertTextPatch(e,i,n)];break;case"remove_text":l=[...l,...o.removeTextPatch(e,i,n)];break;case"remove_node":l=[...l,...o.removeNodePatch(e,i,n)];break;case"split_node":l=[...l,...o.splitNodePatch(e,i,n)];break;case"insert_node":l=[...l,...o.insertNodePatch(e,i,n)];break;case"set_node":l=[...l,...o.setNodePatch(e,i,n)];break;case"merge_node":l=[...l,...o.mergeNodePatch(e,i,n)];break;case"move_node":l=[...l,...o.moveNodePatch(e,i,n)]}return!c&&h&&["merge_node","set_node","remove_text","remove_node"].includes(i.type)&&(l=[...l,eb([])],r.next({type:"unset",previousValue:eE(n,s.block.name,ed.get(e))})),c&&l.length>0&&(l=[em([],[]),...l]),l.length>0&&l.forEach(e=>{r.next({type:"patch",patch:{...e,origin:"local"}})}),e},e}}({change$:y,isPending:c,keyGenerator:i,patches$:o,patchFunctions:k,readOnly:a,schemaTypes:m}),T=(n=s||-1,function(e){let{apply:t}=e;return e.apply=r=>{n>0&&e.children.length>=n&&("insert_node"===r.type||"split_node"===r.type)&&1===r.path.length||t(r)},e}),A=function(e){return e.pteToggleListItem=t=>{let n=e.pteHasListStyle(t);n?(tr("Remove list item '".concat(t,"'")),e.pteUnsetListItem(t)):(tr("Add list item '".concat(t,"'")),e.pteSetListItem(t))},e.pteUnsetListItem=t=>{if(!e.selection)return;let n=[...x.ML.nodes(e,{at:e.selection,match:e=>x.W_.isElement(e)&&e._type===m.block.name})];n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let{listItem:n,level:l,...o}=r,a={...o,listItem:void 0,level:void 0};tr("Unsetting list '".concat(t,"'")),x.YR.setNodes(e,a,{at:i})}})},e.pteSetListItem=t=>{if(!e.selection)return;let n=[...x.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];n.forEach(n=>{let[r,i]=n;tr("Setting list '".concat(t,"'")),x.YR.setNodes(e,{...r,level:1,listItem:t||m.lists[0]&&m.lists[0].value},{at:i})})},e.pteEndList=()=>{if(!e.selection)return!1;let t=[...x.ML.nodes(e,{at:e.selection,match:t=>x.W_.isElement(t)&&e.isListBlock(t)&&1===t.children.length&&x.xv.isText(t.children[0])&&""===t.children[0].text})];return 0!==t.length&&(t.forEach(t=>{let[n,r]=t;x.W_.isElement(n)&&(tr("Unset list"),x.YR.setNodes(e,{...n,level:void 0,listItem:void 0},{at:r}))}),!0)},e.pteIncrementBlockLevels=t=>{if(!e.selection)return!1;let n=[...x.ML.nodes(e,{at:e.selection,match:t=>!!e.isListBlock(t)})];return 0!==n.length&&(n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let n=r.level||1;t?tr("Decrementing list level",Math.min(10,Math.max(1,--n))):tr("Incrementing list level",Math.min(10,Math.max(1,++n))),x.YR.setNodes(e,{level:Math.min(10,Math.max(1,n))},{at:i})}}),!0)},e.pteHasListStyle=t=>{if(!e.selection)return!1;let n=[...x.ML.nodes(e,{at:e.selection,match:n=>e.isListBlock(n)&&n.listItem===t})];return n.length>0},e},S=function(e){let{readOnly:t,patches$:n}=e,r=[];return e=>{n&&e.subscriptions.push(()=>{eK("Subscribing to patches");let e=n.subscribe(e=>{let{patches:t}=e;t.forEach(e=>{"local"!==e.origin&&r.push({patch:e,time:new Date})})});return()=>{eK("Unsubscribing to patches"),e.unsubscribe()}}),e.history={undos:[],redos:[]};let{apply:i}=e;return e.apply=n=>{if(t){i(n);return}let{operations:r,history:l}=e,{undos:o}=l,a=o[o.length-1],s=a&&a.operations&&a.operations[a.operations.length-1],c=e5(n,s),h=e2(e),f=e1(e);if(null==h&&(h=e7(n)),h){if(null==f&&(f=null!=a&&(0!==r.length||e4(n,s)||c)),a&&f)c&&a.operations.pop(),a.operations.push(n);else{let t={operations:[...null===e.selection?[]:[{type:"set_selection",properties:{...e.selection},newProperties:{...e.selection}}],n],timestamp:new Date};o.push(t),eK("Created new undo step",a)}for(;o.length>300;)o.shift();e9(n)&&(l.redos=[])}i(n)},e.undo=()=>{if(t)return;let{undos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(eK("Undoing",t),t.operations.length>0){let n=[...r.filter(e=>e.time>=t.timestamp)],i=t.operations;n.forEach(t=>{i=L()(i.map(n=>e3(e,t.patch,n)))}),e8(e,()=>{x.ML.withoutNormalizing(e,()=>{i.map(x.OX.inverse).reverse().forEach(n=>{try{e.apply(n)}catch(n){eK("Could not perform undo step",n),e.history.redos.push(t),e.history.undos.pop()}})})})}e.history.redos.push(t),e.history.undos.pop(),e.onChange()}},e.redo=()=>{if(t)return;let{redos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(eK("Redoing",t),t.operations.length>0){let n=r.filter(e=>e.time>t.timestamp),i=t.operations;n.forEach(t=>{i=L()(i.map(n=>e3(e,t.patch,n)))}),e8(e,()=>{x.ML.withoutNormalizing(e,()=>{i.forEach(n=>{try{e.apply(n)}catch(n){eK("Could not perform redo step",n),e.history.undos.push(t),e.history.redos.pop()}})})})}e.history.undos.push(t),e.history.redos.pop(),e.onChange()}},e}}({readOnly:a,patches$:o}),P=function(e){let{apply:t,normalizeNode:n}=e,r=m.decorators.map(e=>e.value);return e.normalizeNode=t=>{n(t),e.operations.some(e=>["insert_node","insert_text","merge_node","remove_node","remove_text","set_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t)for(let[n,r]of Array.from(x.ML.nodes(e,{at:x.ML.range(e,[t.anchor.path[0]],[t.focus.path[0]])})).reverse()){let[t]=r.length>1?x.ML.node(e,x.y$.parent(r)):[void 0],i=[r[0],r[1]+1];if(x.ML.isBlock(e,t)){let r=t.children[i[1]];x.xv.isText(n)&&x.xv.isText(r)&&R()(r.marks,n.marks)&&(ti("Merging spans"),x.YR.mergeNodes(e,{at:i,voids:!0}),e.onChange())}}}(e);let[r,i]=t,l=x.xv.isText(r)&&r._type===m.span.name,o=e.isTextBlock(r);if(l||o){for(let t of(l&&!Array.isArray(r.marks)&&(ti("Adding .marks to span node"),x.YR.setNodes(e,{marks:[]},{at:i}),e.onChange()),e.operations)){if("merge_node"===t.type&&1===t.path.length&&"markDefs"in t.properties&&t.properties._type===m.block.name&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]-1>=0){let[n,r]=x.ML.node(e,[t.path[0]-1]);if(ti("Copying markDefs over to merged block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[],l=H()([...i,...t.properties.markDefs]),o=R()(l,n.markDefs);o||(x.YR.setNodes(e,{markDefs:l},{at:r,voids:!1}),e.onChange())}}if("split_node"===t.type&&1===t.path.length&&x.W_.isElementProps(t.properties)&&t.properties._type===m.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]+1<e.children.length){let[n,r]=x.ML.node(e,[t.path[0]+1]);if(ti("Copying markDefs over to split block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[];x.YR.setNodes(e,{markDefs:H()([...i,...t.properties.markDefs])},{at:r,voids:!1}),e.onChange()}}if("split_node"===t.type&&2===t.path.length&&t.properties._type===m.span.name&&"marks"in t.properties&&Array.isArray(t.properties.marks)&&t.properties.marks.length>0&&t.path[0]+1<e.children.length){let[n,r]=x.ML.node(e,[t.path[0]+1,0]);x.xv.isText(n)&&""===n.text&&Array.isArray(n.marks)&&n.marks.length>0&&(x.YR.setNodes(e,{marks:[]},{at:r,voids:!1}),e.onChange())}if("split_node"===t.type&&1===t.path.length&&t.properties._type===m.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0){let[n,r]=x.ML.node(e,[t.path[0]]);e.isTextBlock(n)&&1===n.children.length&&n.markDefs&&n.markDefs.length>0&&x.xv.isText(n.children[0])&&""===n.children[0].text&&(!n.children[0].marks||0===n.children[0].marks.length)&&(x.YR.setNodes(e,{markDefs:[]},{at:r}),e.onChange())}}l&&Array.isArray(r.marks)&&r.marks.length>0&&""===r.text&&(x.YR.setNodes(e,{marks:[]},{at:i,voids:!1}),e.onChange())}o&&e.operations.some(e=>["split_node","remove_node","remove_text","merge_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t){let n=x.ML.nodes(e,{at:t,match:e=>e._type===m.block.name});for(let[t,r]of n)if(e.isTextBlock(t)){let n=(t.markDefs||[]).filter(e=>t.children.find(t=>x.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));R()(n,t.markDefs)||(ti("Removing markDef not in use"),x.YR.setNodes(e,{markDefs:n},{at:r}),e.onChange())}}}(e)},e.apply=n=>{var i,l;if("insert_text"===n.type){let{selection:o}=e;if(o&&x.e6.isCollapsed(o)&&(null==(l=null==(i=x.ML.marks(e))?void 0:i.marks)?void 0:l.some(e=>!r.includes(e)))){let[i]=Array.from(x.ML.nodes(e,{mode:"lowest",at:o.focus,match:e=>e._type===m.span.name,voids:!1}))[0]||[void 0];if(x.xv.isText(i)&&i.text.length===o.focus.offset&&Array.isArray(i.marks)&&i.marks.length>0){t(n),x.YR.splitNodes(e,{match:x.xv.isText,at:{...o.focus,offset:o.focus.offset}});let i=(({...x.ML.marks(e)||{}}).marks||[]).filter(e=>r.includes(e));x.YR.setNodes(e,{marks:i},{at:x.y$.next(o.focus.path)});return}}}t(n)},e.addMark=t=>{if(e.selection){if(x.e6.isExpanded(e.selection)){x.YR.setNodes(e,{},{match:x.xv.isText,split:!0});let n=[...x.ML.nodes(e,{at:e.selection,match:x.xv.isText})],r=L()(n.map(e=>e[0]).map(e=>e.marks)).includes(t);if(r){e.removeMark(t);return}x.ML.withoutNormalizing(e,()=>{n.forEach(n=>{let[r,i]=n,l=[...(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t),t];x.YR.setNodes(e,{marks:l},{at:i,match:x.xv.isText,split:!0,hanging:!0})})}),x.ML.normalize(e)}else{let n={...x.ML.marks(e)||{}}.marks||[],r={...x.ML.marks(e)||{},marks:[...n,t]};e.marks=r}e.onChange()}},e.removeMark=t=>{let{selection:n}=e;if(n){if(x.e6.isExpanded(n))x.ML.withoutNormalizing(e,()=>{if(x.YR.setNodes(e,{},{match:x.xv.isText,split:!0}),e.selection){let n=[...x.ML.nodes(e,{at:e.selection,match:x.xv.isText})];n.forEach(n=>{let[r,i]=n,l=e.children[i[0]];x.W_.isElement(l)&&l.children.includes(r)&&x.YR.setNodes(e,{marks:(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t)},{at:i})})}}),x.ML.normalize(e);else{let n={...x.ML.marks(e)||{}}.marks||[],r={...x.ML.marks(e)||{},marks:n.filter(e=>e!==t)};e.marks=r}e.onChange()}},e.pteIsMarkActive=t=>{if(!e.selection||e.selection.focus.path.length<2)return!1;let n={...x.ML.marks(e)||{}}.marks||[];return x.e6.isExpanded(e.selection)&&Array.from(x.ML.nodes(e,{match:x.xv.isText,at:e.selection})).forEach(e=>{let[t]=e;n=H()([...n,...t.marks||[]])}),n.includes(t)},e.pteToggleMark=t=>{let n=e.pteIsMarkActive(t);n?(ti("Remove mark '".concat(t,"'")),x.ML.removeMark(e,t)):(ti("Add mark '".concat(t,"'")),x.ML.addMark(e,t,!0)),e.onChange()},e},B=function(e,t){let n=e.styles[0].value;return function(t){let{normalizeNode:r}=t;return t.normalizeNode=e=>{r(e);let[,i]=e;for(let e of t.operations)if("split_node"===e.type&&1===e.path.length&&t.isTextBlock(e.properties)&&e.properties.style!==n&&e.path[0]===i[0]&&!x.y$.equals(i,e.path)){let[r]=x.ML.node(t,[e.path[0]+1,0]);if(x.xv.isText(r)&&""===r.text){tn("Normalizing split node to ".concat(n," style"),e),x.YR.setNodes(t,{style:n},{at:[e.path[0]+1],voids:!1});break}}},t.pteHasBlockStyle=e=>{if(!t.selection)return!1;let n=[...x.ML.nodes(t,{at:t.selection,match:n=>t.isTextBlock(n)&&n.style===e})];return n.length>0},t.pteToggleBlockStyle=r=>{if(!t.selection)return;let i=[...x.ML.nodes(t,{at:t.selection,match:t=>x.W_.isElement(t)&&t._type===e.block.name})];i.forEach(e=>{let[i,l]=e;t.isTextBlock(i)&&i.style===r?(tn("Unsetting block style '".concat(r,"'")),x.YR.setNodes(t,{...i,style:n},{at:l})):(r?tn("Setting style '".concat(r,"'")):tn("Setting default style",n),x.YR.setNodes(t,{...i,style:r||n},{at:l}))}),t.onChange()},t}}(m),O=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.createPlaceholderBlock=()=>(tt("Creating placeholder block"),{_type:t.block.name,_key:n(),style:t.styles[0].value||"normal",markDefs:[],children:[{_type:"span",_key:n(),text:"",marks:[]}]}),e}}({keyGenerator:i,schemaTypes:m}),W=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.pteExpandToWord=()=>{let{selection:t}=e;if(t&&!x.e6.isExpanded(t)){let[n]=x.ML.node(e,t.focus,{depth:2});if(!n||!x.xv.isText(n)||0===n.text.length){ta("pteExpandToWord: Can't expand to word here");return}let{focus:r}=t,i=r.offset,l=n.text.slice(0,i),o=n.text.slice(i,-1),a=e=>e.match(/\s/g),s=l.split("").reverse().findIndex(e=>a(e)),c=s>-1?l.length-s:0,h=o.split("").findIndex(e=>a(e)),f=l.length+(h>-1?h:o.length+1);if(!(c===f||isNaN(c)||isNaN(f))){ta("pteExpandToWord: Expanding to focused word"),x.YR.setSelection(e,{anchor:{...t.anchor,offset:c},focus:{...t.focus,offset:f}});return}ta("pteExpandToWord: Can't expand to word here")}},e}}({keyGenerator:i,schemaTypes:m}),J=(r=null,function(e){let t=()=>{if(r!==e.selection){let t=null;if(e.selection){let n=ep.get(e.selection);if(n)t=n;else{let n=e.children;t=eC(n,e.selection,m),ep.set(e.selection,t)}}tl("Emitting selection ".concat(JSON.stringify(t||null))),t?y.next({type:"selection",selection:t}):y.next({type:"selection",selection:null})}r=e.selection},{onChange:n}=e;return e.onChange=()=>{let r=e.operations.length>0;n(),r&&t()},e});return(e.destroy=()=>{let t=tu.get(e);if(!t)throw Error("Could not find pristine versions of editor functions");e.onChange=t.onChange,e.apply=t.apply,e.normalizeNode=t.normalizeNode},a)?{editor:_(v(P(B(W(O(A(J(w(e))))))))),subscribe:()=>M()}:{editor:_(v(P(B(A(O(W(T(S(E(J(w(e)))))))))))),subscribe:()=>{let t=[];return e.subscriptions.forEach(e=>{t.push(e())}),()=>{t.forEach(e=>{e()})}}}},tm=er("component:PortableTextEditor:SlateContainer");function ty(e){let{patches$:t,portableTextEditor:n,readOnly:r,maxBlocks:i,keyGenerator:l,isPending:o}=e,[a,h]=(0,c.useMemo)(()=>{tm("Creating new Slate editor instance");let{editor:e,subscribe:a}=tg((0,b.BU)((0,x.Jh)()),{isPending:o,keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r});return ed.set(e,{}),ef.set(e,{}),[e,a]},[]);(0,c.useEffect)(()=>{let e=h();return()=>{e()}},[h]),(0,c.useEffect)(()=>{tm("Re-initializing plugin chain"),tg(a,{isPending:o,keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r})},[l,n,i,r,t,a,o]);let f=(0,c.useMemo)(()=>[a.createPlaceholderBlock()],[a]);return(0,c.useEffect)(()=>()=>{tm("Destroying Slate editor"),a.destroy()},[a]),(0,s.jsx)(b.mH,{editor:a,value:f,children:e.children})}let tk=(0,c.createContext)(null),tv=()=>{let e=(0,c.useContext)(tk);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},t_=(0,c.createContext)(null),tb=()=>{let e=(0,c.useContext)(t_);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e},tx=(0,c.createContext)(void 0),tw=(0,c.createContext)(!1),tM=()=>{let e=(0,c.useContext)(tw);if(void 0===e)throw Error("The `usePortableTextEditorReadOnly` hook must be used inside the <PortableTextEditor> component's context.");return e},tE=er("hook:useSyncValue"),tN=er("component:PortableTextEditor:Synchronizer");function tT(e){let{change$:t,portableTextEditor:n,isPending:r,onChange:i,keyGenerator:l,readOnly:o,value:a}=e,[h,f]=(0,c.useState)(null),d=(0,c.useRef)([]),p=function(e){let{portableTextEditor:t,isPending:n,readOnly:r,keyGenerator:i}=e,{change$:l,schemaTypes:o}=t,a=(0,c.useRef)(),s=(0,b.ui)();return(0,c.useMemo)(()=>e=>{if(n.current&&!r){tE("Has local patches");return}if(a.current===e){tE("Value is the same object"),l.next({type:"value",value:e});return}if(e&&0===e.length){let t=th(e,o,i);l.next({type:"invalidValue",resolution:t.resolution,value:e});return}let t=!1,c=!0;if(a.current=e,e&&0!==e.length||(tE("Value is empty"),e8(s,()=>{eB(s,()=>{x.ML.withoutNormalizing(s,()=>{let e=!!s.selection;e&&x.YR.deselect(s);let t=s.children.length;s.children.forEach((e,n)=>{x.YR.removeNodes(s,{at:[t-1-n]})}),x.YR.insertNodes(s,s.createPlaceholderBlock(),{at:[0]}),e&&x.YR.select(s,[0,0])})})}),t=!0),e&&e.length>0){let n=eM(e,{schemaTypes:o},ef.get(s));e8(s,()=>{eB(s,()=>{x.ML.withoutNormalizing(s,()=>{let r=s.children.length;if(n.length<r){for(let e=r-1;e>n.length-1;e--)x.YR.removeNodes(s,{at:[e]});t=!0}n.forEach((n,r)=>{let a=s.children[r],h=a&&!R()(n,a);if(h&&c){let h=[e[r]],f=th(h,o,i);f.valid?(a._key===n._key?(tE("Updating block",a,n),function(e,t,n,r){if(x.YR.setNodes(e,t,{at:[r]}),e.isTextBlock(t)&&e.isTextBlock(n)){let i=n.children.length;t.children.length<i&&Array.from(Array(i-t.children.length)).forEach((t,n)=>{let l=i-1-n;l>0&&(tE("Removing child"),x.YR.removeNodes(e,{at:[r,l]}))}),t.children.forEach((i,l)=>{let o=n.children[l],a=!R()(i,o);a&&(i._key===(null==o?void 0:o._key)?(tE("Updating changed child",i),x.YR.setNodes(e,i,{at:[r,l]}),"span"!==i._type&&(tE("Updating changed inline object child",i),x.YR.setNodes(e,{_key:"".concat(t._key,"-void-child")},{at:[r,l,0],voids:!0}))):o?(tE("Replacing child",i),x.YR.removeNodes(e,{at:[r,l]}),eR(e,()=>{x.YR.insertNodes(e,i,{at:[r,l]})})):o||(tE("Inserting new child",i),eR(e,()=>{x.YR.insertNodes(e,i,{at:[r,l]})})))})}}(s,n,a,r)):(tE("Replacing block",a,n),function(e,t,n){let r=e.selection,i=r&&r.focus.path[0]===n;i&&x.YR.deselect(e),x.YR.removeNodes(e,{at:[n]}),eR(e,()=>{x.YR.insertNodes(e,t,{at:[n]})}),i&&x.YR.select(e,r)}(s,n,r)),t=!0):(l.next({type:"invalidValue",resolution:f.resolution,value:e}),c=!1)}if(!a&&c){let t=[e[r]],a=th(t,o,i);tE("Validating and inserting new block in the end of the value",n),a.valid?eR(s,()=>{x.YR.insertNodes(s,n,{at:[r]})}):(l.next({type:"invalidValue",resolution:a.resolution,value:e}),c=!1)}})})})})}if(!c){tE("Invalid value, returning");return}t?(tE("Server value changed, syncing editor"),x.ML.normalize(s),s.onChange(),l.next({type:"value",value:e})):tE("Server value and editor value is the same, no need to sync.")},[l,n,i,r,o,s])}({isPending:r,keyGenerator:l,onChange:i,portableTextEditor:n,readOnly:o}),u=(0,c.useCallback)(()=>{let e=[...d.current];tN("Flushing pending patches",e),e.length>0&&(d.current=d.current.splice(e.length,d.current.length),i({type:"mutation",patches:e}))},[i]),g=(0,c.useMemo)(()=>K()(u,1e3,{leading:!1,trailing:!0}),[u]);(0,c.useEffect)(()=>()=>{u()},[u]),(0,c.useEffect)(()=>{tN("Subscribing to editor changes$");let e=t.subscribe(e=>{switch(e.type){case"patch":r.current=!0,d.current.push(e.patch),i(e),g();break;case"selection":(0,c.startTransition)(()=>{tN("Setting selection"),f(e.selection)}),i(e);break;default:i(e)}});return()=>{tN("Unsubscribing to changes$"),e.unsubscribe()}},[t,g,i,p,r]);let m=(0,c.useRef)(!0);return(0,c.useEffect)(()=>{tN("Value from props changed, syncing new value"),p(a),m.current&&(t.next({type:"loading",isLoading:!1}),t.next({type:"ready"}),m.current=!1)},[t,p,a]),(0,s.jsx)(el.Provider,{value:l,children:(0,s.jsx)(t_.Provider,{value:n,children:(0,s.jsx)(tx.Provider,{value:a,children:(0,s.jsx)(tw.Provider,{value:o,children:(0,s.jsx)(tk.Provider,{value:h,children:e.children})})})})})}let tD=er("component:PortableTextEditor");class tA extends c.Component{constructor(e){if(super(e),this.change$=new m.x,this.setEditable=e=>{this.editable={...this.editable,...e}},!e.schemaType)throw Error('PortableTextEditor: missing "type" property');e.incomingPatches$&&console.warn("The prop 'incomingPatches$' is deprecated and renamed to 'patches$'"),this.change$.next({type:"loading",isLoading:!0}),this.isPending=(0,c.createRef)(),this.isPending.current=!1,this.schemaTypes=et(e.schemaType.hasOwnProperty("jsonType")?e.schemaType:ee(e.schemaType))}componentDidUpdate(e){this.props.schemaType!==e.schemaType&&(this.schemaTypes=et(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:ee(this.props.schemaType)))}render(){let{onChange:e,value:t,children:n,patches$:r,incomingPatches$:i}=this.props,{change$:l,isPending:o}=this,a=void 0===this.props.maxBlocks?void 0:parseInt(this.props.maxBlocks.toString(),10)||void 0,c=!!this.props.readOnly,h=this.props.keyGenerator||ei;return(0,s.jsx)(ty,{isPending:o,keyGenerator:h,maxBlocks:a,patches$:i||r,portableTextEditor:this,readOnly:c,children:(0,s.jsx)(tT,{change$:l,isPending:o,keyGenerator:h,onChange:e,portableTextEditor:this,readOnly:c,value:t,children:n})})}}function tC(e,t){if(!e||!t)return null;let n=[],r=e.offset||0,i="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,l="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,o=t.find(e=>e._key===i);if(!o)return null;if(n.push({_key:o._key}),o&&"children"===e.path[1]){if(!o.children||Array.isArray(o.children)&&0===o.children.length)return null;let t=Array.isArray(o.children)&&o.children.find(e=>e._key===l);if(!t)return null;n.push("children"),n.push({_key:t._key}),r=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:r}}function tS(e){let t=(0,c.useCallback)(()=>alert(JSON.stringify(e.annotation)),[e.annotation]);return(0,s.jsx)("span",{style:{color:"blue"},onClick:t,children:e.children})}tA.activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[],tA.addAnnotation=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.addAnnotation(t,n)},tA.blur=e=>{var t;tD("Host blurred"),null==(t=e.editable)||t.blur()},tA.delete=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.delete(t,n)},tA.findDOMNode=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.findDOMNode(t)},tA.findByPath=(e,t)=>{var n;return(null==(n=e.editable)?void 0:n.findByPath(t))||[]},tA.focus=e=>{var t;tD("Host requesting focus"),null==(t=e.editable)||t.focus()},tA.focusBlock=e=>{var t;return null==(t=e.editable)?void 0:t.focusBlock()},tA.focusChild=e=>{var t;return null==(t=e.editable)?void 0:t.focusChild()},tA.getSelection=e=>e.editable?e.editable.getSelection():null,tA.getValue=e=>{var t;return null==(t=e.editable)?void 0:t.getValue()},tA.hasBlockStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasBlockStyle(t)},tA.hasListStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasListStyle(t)},tA.isCollapsedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isCollapsedSelection()},tA.isExpandedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isExpandedSelection()},tA.isMarkActive=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isMarkActive(t)},tA.insertChild=(e,t,n)=>{var r;return tD("Host inserting child"),null==(r=e.editable)?void 0:r.insertChild(t,n)},tA.insertBlock=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.insertBlock(t,n)},tA.insertBreak=e=>{var t;return null==(t=e.editable)?void 0:t.insertBreak()},tA.isVoid=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isVoid(t)},tA.isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1],r=t.length>1&&"children"!==t[1];return r||n},tA.marks=e=>{var t;return null==(t=e.editable)?void 0:t.marks()},tA.select=(e,t)=>{var n;tD("Host setting selection",t),null==(n=e.editable)||n.select(t)},tA.removeAnnotation=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.removeAnnotation(t)},tA.toggleBlockStyle=(e,t)=>{var n;return tD("Host is toggling block style"),null==(n=e.editable)?void 0:n.toggleBlockStyle(t)},tA.toggleList=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.toggleList(t)},tA.toggleMark=(e,t)=>{var n;tD("Host toggling mark",t),null==(n=e.editable)||n.toggleMark(t)};let tL=er("components:Leaf"),tP=[],tR=e=>{let{attributes:t,children:n,leaf:r,schemaTypes:i,renderChild:l,renderDecorator:o,renderAnnotation:a}=e,h=c.useRef(null),f=tb(),d=(0,b.vt)(),[p,u]=(0,c.useState)(!1),[g,m]=(0,c.useState)(!1),y=n.props.parent,k=(0,c.useMemo)(()=>y?[{_key:null==y?void 0:y._key},"children",{_key:r._key}]:[],[y,r._key]),v=(0,c.useMemo)(()=>i.decorators.map(e=>e.value),[i.decorators]),_=(0,c.useMemo)(()=>H()((r.marks||tP).filter(e=>v.includes(e))),[v,r.marks]),w=Array.isArray(r.marks)?r.marks:tP,M=(0,c.useMemo)(()=>w.map(e=>{var t;return!v.includes(e)&&(null==(t=null==y?void 0:y.markDefs)?void 0:t.find(t=>t._key===e))}).filter(Boolean),[w,y,v]),E=M.length>0&&d;(0,c.useEffect)(()=>{if(!E){u(!1);return}let e=tA.getSelection(f);e&&R()(e.focus.path,k)&&tA.isCollapsedSelection(f)&&(0,c.startTransition)(()=>{u(!0)})},[E,k,f]);let N=(0,c.useCallback)(()=>{if(!E)return;tL("Setting selection and focus from range");let e=window.getSelection();if(!e){m(!1);return}if(e&&e.rangeCount>0){let t=e.getRangeAt(0);h.current&&t.intersectsNode(h.current)?m(!0):m(!1)}else m(!1)},[E]);(0,c.useEffect)(()=>{if(!E)return;let e=f.change$.subscribe(e=>{if("blur"===e.type){u(!1),m(!1);return}if("focus"===e.type){let e=tA.getSelection(f);e&&R()(e.focus.path,k)&&tA.isCollapsedSelection(f)&&u(!0),N();return}"selection"===e.type&&(e.selection&&R()(e.selection.focus.path,k)&&tA.isCollapsedSelection(f)?u(!0):u(!1),N())});return()=>{e.unsubscribe()}},[k,f,N,E]),(0,c.useEffect)(()=>N(),[N]);let T=(0,c.useMemo)(()=>{let e=n;if(x.xv.isText(r)&&r._type===i.span.name&&(_.forEach(t=>{let n=i.decorators.find(e=>e.value===t);if(n&&o){let r=Object.defineProperty({children:e,editorElementRef:h,focused:p,path:k,selected:g,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=o(r)}}),y&&M.length>0&&M.forEach(t=>{let n=i.annotations.find(e=>e.name===t._type);if(n){if(a){let r=Object.defineProperty({block:y,children:e,editorElementRef:h,focused:p,path:k,selected:g,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=(0,s.jsx)("span",{ref:h,children:a(r)})}else e=(0,s.jsx)(tS,{annotation:t,children:(0,s.jsx)("span",{ref:h,children:e})})}}),y&&l)){let t=y.children.find(e=>e._key===r._key);if(t){let n=(0,s.jsx)(s.Fragment,{children:e}),r=Object.defineProperty({annotations:M,children:n,editorElementRef:h,focused:p,path:k,schemaType:i.span,selected:g,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),i.span)});e=l(r)}}return e},[M,y,n,p,r,_,k,a,l,o,i.annotations,i.decorators,i.span,g]);return(0,c.useMemo)(()=>(0,s.jsx)("span",{...t,ref:h,children:T},r._key),[r,t,T])},tI=e=>(0,s.jsx)("div",{children:(0,s.jsx)("pre",{children:JSON.stringify(e.value,null,2)})}),tB=X.ZP.div(i||(i=Q(["\n  user-select: none;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");X.ZP.span(l||(l=Q(["\n  background: #999;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");let tj=X.ZP.div(o||(o=Q(["\n  &.pt-list-item {\n    width: fit-content;\n    position: relative;\n    display: block;\n\n    /* Important 'transform' in order to force refresh the ::before and ::after rules\n      in Webkit: https://stackoverflow.com/a/21947628/831480\n    */\n    transform: translateZ(0);\n    margin-left: ",";\n  }\n  &.pt-list-item > .pt-list-item-inner {\n    display: flex;\n    margin: 0;\n    padding: 0;\n    &:before {\n      justify-content: flex-start;\n      vertical-align: top;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner:before {\n      content: '","';\n      font-size: 0.4375rem; /* 7px */\n      line-height: 1.5rem; /* Same as body text */\n      /* Optical alignment */\n      position: relative;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner {\n    &:before {\n      min-width: 1.5rem; /* Make sure space between bullet and text never shrinks */\n    }\n  }\n  &.pt-list-item-number {\n    counter-increment: ",";\n    counter-reset: ",";\n  }\n  & + :not(.pt-list-item-number) {\n    counter-reset: listItemNumber;\n  }\n  &.pt-list-item-number > .pt-list-item-inner:before {\n    content: ",";\n    min-width: 1.5rem; /* Make sure space between number and text never shrinks */\n    /* Optical alignment */\n    position: relative;\n    top: 1px;\n  }\n"])),e=>(function(e){switch(Number(e)){case 1:return"1.5em";case 2:return"3em";case 3:return"4.5em";case 4:return"6em";case 5:return"7.5em";case 6:return"9em";case 7:return"10.5em";case 8:return"12em";case 9:return"13.5em";case 10:return"15em";default:return"0em"}})(e.listLevel),e=>{var t;return t=e.listLevel,"bullet"===e.listStyle?tY[(t-1)%3]:"*"},e=>(function(e){switch(e){case 1:return"listItemNumber";case 2:return"listItemAlpha";case 3:return"listItemRoman";case 4:return"listItemNumberNext";case 5:return"listItemLetterNext";case 6:return"listItemRomanNext";case 7:return"listItemNumberNextNext";case 8:return"listItemAlphaNextNext";case 9:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"listItemAlpha";case 2:return"listItemRoman";case 3:return"listItemNumberNext";case 4:return"listItemLetterNext";case 5:return"listItemRomanNext";case 6:return"listItemNumberNextNext";case 7:return"listItemAlphaNextNext";case 8:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"counter(listItemNumber) '. '";case 2:return"counter(listItemAlpha, lower-alpha) '. '";case 3:return"counter(listItemRoman, lower-roman) '. '";case 4:return"counter(listItemNumberNext) '. '";case 5:return"counter(listItemLetterNext, lower-alpha) '. '";case 6:return"counter(listItemRomanNext, lower-roman) '. '";case 7:return"counter(listItemNumberNextNext) '. '";case 8:return"counter(listItemAlphaNextNext, lower-alpha) '. '";case 9:return"counter(listItemRomanNextNext, lower-roman) '. '";default:return"counter(listItemNumberNextNextNext) '. '"}})(e.listLevel)),tO=X.ZP.div(a||(a=Q([""]))),tY=["","",""],tW=er("components:DraggableBlock"),tz=e=>{let{children:t,element:n,readOnly:r,blockRef:i}=e,l=(0,b._7)(),o=(0,c.useRef)(),[a,h]=(0,c.useState)(!1),f=(0,c.useMemo)(()=>x.ML.isVoid(l,n),[l,n]),d=(0,c.useMemo)(()=>x.ML.isInline(l,n),[l,n]),[p,u]=(0,c.useState)(null);(0,c.useEffect)(()=>u(i?i.current:b.F3.toDOMNode(l,n)),[l,n,i]);let g=(0,c.useCallback)(e=>{let t=es.get(l);if(!t||!p)return;e.preventDefault(),e.dataTransfer.dropEffect="move",ec.set(l,n);let r=p.getBoundingClientRect(),i=r.top,o=r.height,a=e.pageY,s="bottom";if(n===l.children[0]?s="top":Math.abs(i-a)<o/2?(s="top",eh.set(l,s)):(s="bottom",eh.set(l,s)),t===n){e.dataTransfer.dropEffect="none";return}h(!0)},[p,l,n]),m=(0,c.useCallback)(()=>{h(!1)},[]),y=(0,c.useCallback)(e=>{let t=ec.get(l);if(t){ea.set(l,!1),e.preventDefault(),e.stopPropagation(),ec.delete(l),o.current&&(tW("Removing drag ghost"),document.body.removeChild(o.current));let r=eh.get(l);eh.delete(l);let i=b.F3.findPath(l,t),a=b.F3.findPath(l,n),s=x.y$.isBefore(a,i);if("bottom"===r&&!s){if(i[0]>=l.children.length-1){tW("target is already at the bottom, not moving");return}let e=i;i=x.y$.next(i),tW("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if("top"===r&&s&&i[0]!==l.children.length-1){let e=i;i=x.y$.previous(i),tW("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if(x.y$.equals(i,a)){e.preventDefault(),tW("targetPath and myPath is the same, not moving");return}tW("Moving element ".concat(n._key," from path ").concat(JSON.stringify(a)," to ").concat(JSON.stringify(i)," (").concat(r,")")),x.YR.moveNodes(l,{at:a,to:i}),l.onChange();return}tW("No target element, not doing anything")},[l,n]),k=(0,c.useCallback)(e=>{es.get(l)&&(tW("On drop (prevented)",n),e.preventDefault(),e.stopPropagation(),h(!1))},[l,n]),v=(0,c.useCallback)(e=>{if(!f){es.delete(l);return}ea.set(l,!0),es.set(l,n),e.stopPropagation();let t=e.target;t instanceof HTMLElement&&(t.style.opacity="1")},[l,n,f]),_=(0,c.useCallback)(e=>{if(!f||d){tW("Not dragging block"),es.delete(l),ea.set(l,!1);return}if(tW("Drag start"),ea.set(l,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),p&&p instanceof HTMLElement){let t=p.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){o.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let n=p.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top;t.style.width="".concat(n.width,"px"),t.style.height="".concat(n.height,"px"),e.dataTransfer.setDragImage(t,r,i)}}v(e)},[p,l,v,d,f]),w=a&&l.children[0]===ec.get(l),M=a&&l.children[l.children.length-1]===ec.get(l),E=eh.get(l),N=(0,c.useMemo)(()=>(0,s.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),[]);return r?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsxs)("div",{draggable:f,onDragStart:_,onDrag:v,onDragOver:g,onDragLeave:m,onDragEnd:y,onDrop:k,children:[(w||a&&!w&&!M&&"top"===E)&&N,t,(M||a&&!w&&!M&&"bottom"===E)&&N]})};er("components:Element");let tJ=[],tV={display:"inline-block"},tF=e=>{let t,n,{attributes:r,children:i,element:l,schemaTypes:o,readOnly:a,renderBlock:h,renderChild:f,renderListItem:d,renderStyle:p,spellCheck:u}=e,g=(0,b._7)(),m=(0,b.vt)(),y=(0,c.useRef)(null),k=(0,c.useRef)(null),v=m&&g.selection&&x.e6.isCollapsed(g.selection)||!1,_=(0,c.useMemo)(()=>eE([l],o.block.name,ed.get(g))[0],[g,l,o.block.name]),w=i,M=(0,c.useMemo)(()=>[{_key:l._key}],[l]);if("string"!=typeof l._type)throw Error("Expected element to have a _type property");if("string"!=typeof l._key)throw Error("Expected element to have a _key property");if(g.isInline(l)){let e=b.F3.findPath(g,l),[t]=x.ML.node(g,e,{depth:1}),n=o.inlineObjects.find(e=>e.name===l._type);if(!n)throw Error("Could not find type for inline block element");if(x.W_.isElement(t)){let e=[{_key:t._key},"children",{_key:l._key}];return(0,s.jsxs)("span",{...r,children:[i,(0,s.jsxs)("span",{draggable:!a,className:"pt-inline-object",ref:k,style:tV,contentEditable:!1,children:[f&&f({annotations:tJ,children:(0,s.jsx)(tI,{value:_}),editorElementRef:k,focused:v,path:e,schemaType:n,selected:m,type:n,value:_}),!f&&(0,s.jsx)(tI,{value:_})]},l._key)]})}throw Error("Block not found!")}if(l._type===o.block.name){let e;t="pt-block pt-text-block";let n="listItem"in l,c="style"in l&&l.style||"normal";t="pt-block pt-text-block pt-text-block-style-".concat(c);let f=o.styles.find(e=>e.value===c);if(p&&f&&(w=p({block:l,children:i,focused:v,selected:m,value:c,path:M,schemaType:f,editorElementRef:y})),n&&("number"==typeof l.level&&(e=l.level),t+=" pt-list-item pt-list-item-".concat(l.listItem," pt-list-item-level-").concat(e||1)),g.isListBlock(_)&&n&&l.listItem){let e=o.lists.find(e=>e.value===l.listItem);w=d&&e?d({block:_,children:w,focused:v,selected:m,value:l.listItem,path:M,schemaType:e,level:_.level||1,editorElementRef:y}):(0,s.jsx)(tj,{listStyle:_.listItem||o.lists[0].value,listLevel:_.level||1,children:(0,s.jsx)(tO,{children:w})})}let k=Object.defineProperty({children:w,editorElementRef:y,focused:v,level:e,listItem:n?l.listItem:void 0,path:M,selected:m,style:c,schemaType:o.block,value:_},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),o.block)}),b=h?h(k):i;return(0,s.jsx)("div",{...r,className:t,spellCheck:u,children:(0,s.jsx)(tz,{element:l,readOnly:a,blockRef:y,children:(0,s.jsx)("div",{ref:y,children:b})})},l._key)}let E=o.blockObjects.find(e=>e.name===l._type);if(!E)throw Error("Could not find schema type for block element of _type ".concat(l._type));t="pt-block pt-object-block";let N=eE([l],o.block.name,ed.get(g))[0];if(h){let e=Object.defineProperty({children:(0,s.jsx)(tI,{value:_}),editorElementRef:y,focused:v,path:M,schemaType:E,selected:m,value:N},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),E)});n=h(e)}return(0,s.jsxs)("div",{...r,className:t,children:[i,(0,s.jsxs)(tz,{element:l,readOnly:a,blockRef:y,children:[n&&(0,s.jsx)("div",{ref:y,contentEditable:!1,children:n}),!n&&(0,s.jsx)(tB,{selected:m,children:(0,s.jsx)(tI,{value:_})})]})]},l._key)},tU="undefined"==typeof window?c.useEffect:c.useLayoutEffect,t$=er("component:Editable"),tH={opacity:.5,position:"absolute",userSelect:"none",pointerEvents:"none"},tq=[],tZ=(0,c.forwardRef)(function(e,t){let{hotkeys:n,onBeforeInput:r,onPaste:i,onCopy:l,renderAnnotation:o,renderBlock:a,renderChild:h,renderDecorator:f,renderListItem:d,renderPlaceholder:p,renderStyle:u,selection:g,scrollSelectionIntoView:m,spellCheck:y,...k}=e,v=tb(),_=tM(),w=eo(),E=function(e){let t=(0,c.useRef)(null);return tU(()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}),t}(t),[N,T]=(0,c.useState)(!1),{change$:D,schemaTypes:A}=v,C=(0,b.ui)(),S=A.block.name,L=(0,c.useMemo)(()=>function(e){let t=A.block.name,n=A.span.name,r=t=>t.map(t=>{var r;return e.isTextBlock(t)?t.children.map(e=>{var t;return e._type===n?e.text:"[".concat((null==(t=A.inlineObjects.find(t=>t.name===e._type))?void 0:t.title)||"Object","]")}).join(""):"[".concat((null==(r=A.blockObjects.find(e=>e.name===t._type))?void 0:r.title)||"Object","]")}).join("\n\n");return e.setFragmentData=(n,i)=>{let{selection:l}=e;if(!l)return;let[o,a]=x.e6.edges(l),s=x.ML.void(e,{at:o.path}),c=x.ML.void(e,{at:a.path});if(x.e6.isCollapsed(l)&&!s)return;let h=b.F3.toDOMRange(e,l),f=h.cloneContents();if(c){let[t]=c,n=h.cloneRange(),r=b.F3.toDOMNode(e,t);n.setEndAfter(r),f=n.cloneContents()}Array.from(f.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?"\n":""}),Array.from(f.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let d=f.ownerDocument.createElement("div");d.appendChild(f),d.setAttribute("hidden","true"),f.ownerDocument.body.appendChild(d);let p=d.innerHTML;f.ownerDocument.body.removeChild(d);let u=e.getFragment(),g=eE(u,t),m=JSON.stringify(g),y=r(g);n.clearData(),n.setData("text/plain",y),n.setData("text/html",p),n.setData("application/json",m),n.setData("application/x-portable-text",m),tf("text",y),n.setData("application/x-portable-text-event-origin",i||"external"),tf("Set fragment data",m,p)},e.insertPortableTextData=t=>{var r;if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),l=t.getData("application/x-portable-text-event-origin");if(tf("Inserting portable text from ".concat(l," event"),i),i){let t=JSON.parse(i);if(Array.isArray(t)&&t.length>0){let i=eM(t,{schemaTypes:A}).map(t=>{let r={...t};e.isTextBlock(r)&&(r.markDefs=(r.markDefs||[]).map(t=>{let i=t._key,l=w();return r.children=r.children.map(t=>t._type===n&&e.isTextSpan(t)?{...t,marks:t.marks&&t.marks.includes(i)?[...t.marks].filter(e=>e!==i).concat(l):t.marks}:t),{...t,_key:l}}));let i={...r,_key:w()};return e.isTextBlock(i)&&(i.children=i.children.map(e=>({...e,_key:w()}))),i}),l=th(t,A,w);if(!l.valid){let e="".concat(null==(r=l.resolution)?void 0:r.description);return D.next({type:"error",level:"warning",name:"pasteError",description:e,data:l}),tf("Invalid insert result",l),!1}return tp(e,i,A),!0}}return!1},e.insertTextOrHTMLData=n=>{var r;if(!e.selection)return tf("No selection, not inserting"),!1;D.next({type:"loading",isLoading:!0});let i=n.getData("text/html"),l=n.getData("text/plain");if(i||l){let o,a,s;if(tf("Inserting data",n),i)a=eM(o=(0,Z.zW)(i,A.portableText).map(e=>(0,Z.nX)(e,{blockTypeName:t})),{schemaTypes:A}),s="HTML";else{let e=String(l).replace(/[&<>"'`=/]/g,e=>td[e]).split(/\n{2,}/).map(e=>e?"<p>".concat(e.replace(/(?:\r\n|\r|\n)/g,"<br/>"),"</p>"):"<p></p>").join(""),n="<html><body>".concat(e,"</body></html>");a=eM(o=(0,Z.zW)(n,A.portableText).map(e=>(0,Z.nX)(e,{blockTypeName:t})),{schemaTypes:A}),s="text"}let c=th(o,A,w);if(!c.valid){let e="Could not validate the resulting portable text to insert.\n".concat(null==(r=c.resolution)?void 0:r.description,"\nTry to insert as plain text (shift-paste) instead.");return D.next({type:"error",level:"warning",name:"pasteError",description:e,data:c}),tf("Invalid insert result",c),!1}return tf("Inserting ".concat(s," fragment at ").concat(JSON.stringify(e.selection))),tp(e,a,A),D.next({type:"loading",isLoading:!1}),!0}return D.next({type:"loading",isLoading:!1}),!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let t=JSON.parse(n);return e.insertFragment(t),!0}return!1},e},[D,w,A]),P=(0,c.useMemo)(()=>(function(e,t,n,r){let i=["enter","tab","shift","delete","end"],l=r||tc,o=()=>eM([{_type:e.block.name,_key:t(),style:"normal",markDefs:[],children:[{_type:"span",_key:t(),text:"",marks:[]}]}],n)[0];return function(t){return t.pteWithHotKeys=r=>{Object.keys(l).forEach(e=>{if("marks"===e)for(let n in l[e]){if(i.includes(n))throw Error("The hotkey ".concat(n," is reserved!"));if((0,q.ZP)(n,r.nativeEvent)){r.preventDefault();let i=l[e];if(i){let e=i[n];ts("HotKey ".concat(n," to toggle ").concat(e)),t.pteToggleMark(e)}}}if("custom"===e)for(let t in l[e]){if(i.includes(t))throw Error("The hotkey ".concat(t," is reserved!"));if((0,q.ZP)(t,r.nativeEvent)){let i=l[e];if(i){let e=i[t];e(r,n)}}}});let a=(0,q.ZP)("enter",r.nativeEvent),s=(0,q.ZP)("tab",r.nativeEvent),c=(0,q.ZP)("shift+enter",r.nativeEvent),h=(0,q.ZP)("shift+tab",r.nativeEvent),f=(0,q.ZP)("backspace",r.nativeEvent),d=(0,q.ZP)("delete",r.nativeEvent);if(f&&t.selection&&t.selection.focus.path[0]>0&&x.e6.isCollapsed(t.selection)){let[e,n]=x.ML.node(t,x.y$.previous(t.selection.focus.path.slice(0,1))),[i]=x.ML.node(t,t.selection.focus,{depth:1});if(e&&i&&x.ML.isVoid(t,e)&&0===t.selection.focus.offset){ts("Preventing deleting void block above"),r.preventDefault(),r.stopPropagation(),x.YR.removeNodes(t,{match:e=>e===i}),x.YR.select(t,n),t.onChange();return}}if(d&&t.selection&&0===t.selection.focus.offset&&x.e6.isCollapsed(t.selection)&&t.children[t.selection.focus.path[0]+1]){let[e]=x.ML.node(t,x.y$.next(t.selection.focus.path.slice(0,1))),[n,i]=x.ML.node(t,t.selection.focus,{depth:1});if(e&&n&&!x.ML.isVoid(t,n)&&x.ML.isVoid(t,e)){ts("Preventing deleting void block below"),r.preventDefault(),r.stopPropagation(),x.YR.removeNodes(t,{match:e=>e===n}),x.YR.select(t,i),t.onChange();return}}if((s||h)&&t.selection){let[e]=x.ML.node(t,t.selection.focus,{depth:2}),[n]=(0,I.NG)(e)?x.ML.node(t,t.selection.focus,{depth:1}):[],i=e&&(0,I.DG)(n)&&(0,I.NG)(e)&&(e.marks||[]).filter(e=>(n.markDefs||[]).map(e=>e._key).includes(e)).length>0,[l]=x.e6.edges(t.selection),o=x.ML.isStart(t,l,l.path);e&&(0,I.NG)(e)&&(!i||o)&&t.pteIncrementBlockLevels(h)&&r.preventDefault()}if(a&&!c&&t.selection){let n;try{[n]=x.ML.node(t,t.selection.focus,{depth:1})}catch(e){}if(t.isListBlock(n)){t.pteEndList()&&r.preventDefault();return}if(t.isTextBlock(n)&&n.style&&n.style!==e.styles[0].value){let[,e]=x.e6.edges(t.selection),n=x.ML.isEnd(t,e,e.path);if(n){x.ML.insertNode(t,o()),r.preventDefault();return}}if(n&&x.ML.isVoid(t,n)){x.ML.insertNode(t,o()),r.preventDefault();return}}if(c){r.preventDefault(),t.insertText("\n");return}if((0,q.ZP)("mod+z",r.nativeEvent)){r.preventDefault(),t.undo();return}((0,q.ZP)("mod+y",r.nativeEvent)||(0,q.ZP)("mod+shift+z",r.nativeEvent))&&(r.preventDefault(),t.redo())},t}})(A,w,v,n),[n,w,v,A]);(0,c.useMemo)(()=>_?(t$("Editable is in read only mode"),L(C)):(t$("Editable is in edit mode"),L(P(C))),[_,C,P,L]);let B=(0,c.useCallback)(e=>(0,s.jsx)(tF,{...e,readOnly:_,renderBlock:a,renderChild:h,renderListItem:d,renderStyle:u,schemaTypes:A,spellCheck:y}),[A,y,_,a,h,d,u]),j=(0,c.useCallback)(e=>{let t=(0,s.jsx)(tR,{...e,schemaTypes:A,renderAnnotation:o,renderChild:h,renderDecorator:f,readOnly:_});return p&&e.leaf.placeholder&&""===e.text.text?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:tH,contentEditable:!1,children:p()}),t]}):t},[_,o,h,f,p,A]),O=(0,c.useCallback)(()=>{if(g){t$("Selection from props ".concat(JSON.stringify(g)));let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,r=null,{anchor:i,focus:l}=e;return(i&&t.find(e=>R()({_key:e._key},i.path[0]))&&(n=tC(i,t)),l&&t.find(e=>R()({_key:e._key},l.path[0]))&&(r=tC(l,t)),n&&r)?{anchor:n,focus:r}:null}(g,eE(C.children,S));if(null!==e){t$("Normalized selection from props ".concat(JSON.stringify(e)));let t=eS(e,C);t&&(x.YR.select(C,t),C.operations.some(e=>"set_selection"===e.type)||D.next({type:"selection",selection:e}),C.onChange())}}},[g,C,S,D]);(0,c.useEffect)(()=>{t$("Subscribing to editor changes$");let e=D.subscribe(e=>{switch(e.type){case"ready":O();break;case"invalidValue":T(!0);break;case"value":T(!1)}});return()=>{t$("Unsubscribing to changes$"),e.unsubscribe()}},[D,O]),(0,c.useEffect)(()=>{g&&!N&&O()},[N,g,O]);let Y=(0,c.useCallback)(e=>{if(l){let t=l(e);void 0!==t&&e.preventDefault()}},[l]),W=(0,c.useCallback)(e=>{if(e.preventDefault(),C.selection){if(!i){t$("Pasting normally"),C.insertData(e.clipboardData);return}new Promise(t=>{var n;t(i({event:e,value:tA.getValue(v),path:(null==(n=C.selection)?void 0:n.focus.path)||[],schemaTypes:A}))}).then(t=>{if(t$("Custom paste function from client resolved",t),D.next({type:"loading",isLoading:!0}),!t||!t.insert){t$("No result from custom paste handler, pasting normally"),C.insertData(e.clipboardData);return}if(t&&t.insert){C.insertFragment(eM(t.insert,{schemaTypes:A})),D.next({type:"loading",isLoading:!1});return}console.warn("Your onPaste function returned something unexpected:",t)}).catch(e=>(D.next({type:"loading",isLoading:!1}),console.error(e),e))}},[D,i,v,A,C]),z=(0,c.useCallback)(()=>{D.next({type:"focus"})},[D]),J=(0,c.useCallback)(()=>{D.next({type:"blur"})},[D]),V=(0,c.useCallback)(e=>{r&&r(e)},[r]),F=C.pteWithHotKeys,U=(0,c.useMemo)(()=>void 0===m?void 0:null===m?M():(e,t)=>{m(v,t)},[v,m]),$=(0,c.useCallback)(()=>eN(C.children,A)?[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}]:tq,[A,C]),H=(0,c.useMemo)(()=>(0,s.jsx)(b.CX,{autoFocus:!1,className:"pt-editable",decorate:$,onBlur:J,onCopy:Y,onDOMBeforeInput:V,onFocus:z,onKeyDown:F,onPaste:W,readOnly:_,renderElement:B,renderLeaf:j,scrollSelectionIntoView:U}),[$,Y,F,V,J,z,W,_,B,j,U]);return v?(0,s.jsx)("div",{ref:E,...k,children:N?null:H}):null})}}]);